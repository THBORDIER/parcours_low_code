<h1>Webhook Stripe â†’ Xano â†’ Email Brevo : automatiser l'aprÃ¨s-paiement</h1>

<div class="metadata">
    <p>ğŸ·ï¸ <strong>CatÃ©gorie:</strong> Xano</p>
    <p>ğŸ¯ <strong>Niveau:</strong> AvancÃ©</p>
    <p>ğŸ” <strong>Mots-clÃ©s:</strong> Webhook, Stripe-Signature, checkout.session.completed, Verify Signature, input.raw, input.headers, whsec_, Brevo, API Request, Paiement test, Automatisation email</p>
    <p>ğŸ“… <strong>Mise Ã  jour:</strong> 26/11/2025</p>
    <p>â±ï¸ <strong>Temps passÃ©:</strong> 1h</p>
    <p>âš™ï¸ <strong>Stack:</strong> WeWeb + Xano + Stripe + Brevo</p>
</div>

<div class="tldr">
âœ… <strong>TL;DR :</strong>
Pour recevoir un webhook Stripe dans Xano : (1) crÃ©er un endpoint public, (2) rÃ©cupÃ©rer <code>input.raw</code> et <code>input.headers</code> en mode expression, (3) utiliser l'action Stripe â†’ Verify Signature avec la clÃ© <code>whsec_xxx</code>, (4) tester avec un vrai paiement test car le CLI Stripe n'est pas adaptÃ© au low-code.
</div>

<h2>ğŸ¯ Objectif technique</h2>

<p>Dans le cadre de ma formation de dÃ©veloppeur low-code, j'ai dÃ» rÃ©aliser une fonctionnalitÃ© intÃ©grÃ©e Ã  un parcours de paiement : lorsqu'un utilisateur finalise une session Stripe Checkout, un webhook doit Ãªtre envoyÃ© vers Xano, qui vÃ©rifie la signature, traite les donnÃ©es, et dÃ©clenche l'envoi d'un email via Brevo.</p>

<p>L'objectif est simple : <strong>automatiser une action aprÃ¨s un paiement sans Ã©crire du code back-end complexe</strong>.</p>

<p>ConcrÃ¨tement, le workflow complet :</p>

<ol>
    <li>CrÃ©er un webhook Stripe pour Ã©couter l'Ã©vÃ©nement <code>checkout.session.completed</code></li>
    <li>Le connecter Ã  un endpoint Xano</li>
    <li>VÃ©rifier la signature Stripe (pour rejeter les requÃªtes non authentiques)</li>
    <li>Extraire les informations utiles du paiement (email, nom, montantâ€¦)</li>
    <li>Appeler l'endpoint Brevo pour envoyer l'email de confirmation</li>
</ol>

<p>Ã€ ce stade, tout semblait limpide. La rÃ©alitÃ© ? Une expÃ©rience qui m'a appris Ã©normÃ©mentâ€¦ mais pas sans douleur.</p>

<h2>ğŸ”§ Mise en place du webhook dans Xano</h2>

<p>J'ai crÃ©Ã© un endpoint public dans Xano : <code>/BREVO/stripe-webhook</code></p>

<h3>Ã‰tapes internes au workflow Xano :</h3>

<ol>
    <li>RÃ©cupÃ©rer le payload brut : <code>input.raw</code></li>
    <li>RÃ©cupÃ©rer la signature dans les headers</li>
    <li>VÃ©rifier la signature avec l'action <strong>Stripe â†’ Verify Signature</strong></li>
    <li>Tester si l'Ã©vÃ©nement est bien <code>checkout.session.completed</code></li>
    <li>Extraire les donnÃ©es essentielles du JSON envoyÃ© par Stripe</li>
    <li>Appeler l'endpoint Brevo pour envoyer l'email</li>
    <li>Retourner un status <code>200 OK</code></li>
</ol>

<p>Sur le papier, tout Ã©tait clair. La rÃ©alitÃ© ? <strong>Compliance Stripe + workflow low-code = surprises.</strong></p>

<h2>âš ï¸ La difficultÃ© majeure : vÃ©rification de signature Stripe</h2>

<p>Pour valider l'authenticitÃ© du webhook, Stripe envoie un header :</p>

<pre><code>Stripe-Signature</code></pre>

<p>Xano demande trois Ã©lÃ©ments pour vÃ©rifier cette signature :</p>

<ul>
    <li>Le payload brut (<code>input.raw</code>)</li>
    <li>Le header <code>Stripe-Signature</code></li>
    <li>La clÃ© secrÃ¨te webhook <code>whsec_xxx</code></li>
</ul>

<div class="callout callout-warning">
âš ï¸ <strong>Attention â€” PiÃ¨ge courant</strong><br>
Xano n'affiche pas <code>input.headers</code> dans ses suggestions automatiques ! Pour l'utiliser, vous devez passer le champ en mode <strong>expression</strong> au lieu de "text", puis saisir manuellement <code>input.headers</code>.
</div>

<p>Ce dÃ©tail, minuscule mais crucial, m'a fait perdre un temps fou.</p>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
Dans Xano, lorsqu'un champ ne propose pas la variable souhaitÃ©e en autocomplÃ©tion, cliquez sur l'icÃ´ne <strong>fx</strong> pour passer en mode expression. Vous pourrez alors saisir directement <code>input.headers</code> ou <code>input.raw</code>.
</div>

<h2>ğŸš« Le problÃ¨me des tests webhook Stripe</h2>

<p>Je pensais utiliser le bouton "Envoyer des Ã©vÃ©nements de test" dans l'interface Stripe. Sauf queâ€¦</p>

<p>Dans l'interface rÃ©elle, le bouton apparaÃ®tâ€¦ mais <strong>ne permet pas d'envoyer un webhook directement</strong>.</p>

<p>Ã€ la place, Stripe affiche une pop-up qui dit :</p>

<blockquote>Â« TÃ©lÃ©chargez Stripe CLI pour envoyer des webhooks de test Â»</blockquote>

<p>Et lÃ , dÃ©couverte dÃ©cevante :</p>

<ul>
    <li>Le "shell Stripe" dans le navigateur n'est pas un vrai terminal</li>
    <li><code>stripe listen</code> ne fonctionne pas</li>
    <li><code>--forward-to</code> n'existe pas dans ce contexte</li>
    <li><code>trigger</code> crÃ©e un Ã©vÃ©nement mais ne l'envoie nulle part</li>
    <li>Impossible de forwarder quoi que ce soit vers Xano</li>
</ul>

<div class="callout callout-warning">
âš ï¸ <strong>RÃ©alitÃ© pour les dÃ©veloppeurs low-code</strong><br>
Stripe n'offre plus d'envoi de webhook de test depuis l'UI. Pour un dÃ©veloppeur low-code, devoir installer un CLI complet n'est pas vraiment cohÃ©rent avec la logique "no/low code".
</div>

<h2>âœ… Solution finale : paiement test rÃ©el</h2>

<p>AprÃ¨s une sÃ©rie d'essais infructueux, la seule mÃ©thode fiable pour dÃ©clencher un webhook Stripe dans un environnement low-code :</p>

<p><strong>Faire un vrai paiement test.</strong></p>

<ol>
    <li>CrÃ©er une session checkout test (voir <a href="#" onclick="return false;">l'article sur Stripe Checkout</a>)</li>
    <li>Utiliser la carte de test <code>4242 4242 4242 4242</code></li>
    <li>Valider le paiement</li>
</ol>

<p>DÃ¨s qu'un paiement test est confirmÃ©, Stripe envoie l'Ã©vÃ©nement <code>checkout.session.completed</code> et lÃ , Xano reÃ§oit enfin :</p>

<ul>
    <li>Un vrai header <code>Stripe-Signature</code></li>
    <li>Un vrai payload complet</li>
    <li>Un Ã©vÃ©nement valide</li>
</ul>

<h3>Exemple de donnÃ©es reÃ§ues :</h3>

<pre><code>customer_details.name = "Jenny Rosen"
customer_details.email = "stripe@example.com"
amount_total = 3000
payment_intent = "pi_3SXlS0QUnmjk2lid5Y4BQSEz"</code></pre>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
En mode test Stripe, utilisez les donnÃ©es fictives : nom "Jenny Rosen", email quelconque, et la carte <code>4242 4242 4242 4242</code> avec n'importe quelle date future et CVC.
</div>

<h2>ğŸ“§ Appeler l'endpoint Brevo depuis Xano</h2>

<p>Je pensais que Xano permettrait d'appeler un endpoint interne via une fonction dÃ©diÃ©e. En rÃ©alitÃ© :</p>

<p><strong>Il faut appeler son propre endpoint comme une API externe.</strong></p>

<p>Donc dans le workflow Xano :</p>

<ol>
    <li><strong>Add Function â†’ API Request</strong></li>
    <li>MÃ©thode : <code>POST</code></li>
    <li>URL : l'URL complÃ¨te de votre endpoint Brevo Xano</li>
    <li>Body JSON avec l'email, le nom, etc.</li>
</ol>

<div class="callout callout-advanced">
ğŸ”¬ <strong>Pour aller plus loin</strong><br>
Xano ne propose pas de "call interne" entre endpoints. Chaque endpoint est traitÃ© comme une API isolÃ©e. Pour chaÃ®ner des workflows, vous devez utiliser une <strong>API Request</strong> vers votre propre URL Xano. Cela fonctionne, mais ce n'est pas instinctif pour quelqu'un qui pense "low-code = automatisme".
</div>

<h2>ğŸ’­ Mon ressenti global</h2>

<p>Ce projet m'a clairement montrÃ© :</p>

<ul>
    <li>Ce que veut dire "comprendre un workflow end-to-end"</li>
    <li>Les limites rÃ©elles d'outils low-code face aux exigences de sÃ©curitÃ© comme les webhooks</li>
    <li>Comment Stripe pousse vers ses CLI et outils dÃ©veloppeurs</li>
    <li>Que la documentation ne reflÃ¨te pas toujours la rÃ©alitÃ© de l'interface</li>
    <li>Qu'un test de webhook n'est pas trivial, mÃªme pour des solutions "sans code"</li>
</ul>

<p><strong>Sentiment final : Frustration + apprentissage profond = progression.</strong></p>

<h2>ğŸ“ Conclusion</h2>

<p>AprÃ¨s cette journÃ©e intense :</p>

<ul>
    <li>Mon webhook Xano fonctionne</li>
    <li>La vÃ©rification Stripe est correcte</li>
    <li>Les donnÃ©es sont extraites proprement</li>
    <li>Le paiement dÃ©clenche un email Brevo</li>
    <li>J'ai une comprÃ©hension beaucoup plus avancÃ©e de la mÃ©canique webhook â†’ backend â†’ automatisation</li>
</ul>

<p>MÃªme si l'expÃ©rience n'a pas Ã©tÃ© simple, j'en sors avec une <strong>rÃ©elle compÃ©tence low-code avancÃ©e</strong>.</p>

<div class="summary">
ğŸ“Œ <strong>Ã€ retenir :</strong>
<ul>
    <li>Pour accÃ©der Ã  <code>input.headers</code> dans Xano, passez en mode expression (fx)</li>
    <li>La vÃ©rification de signature Stripe nÃ©cessite : payload brut + header Stripe-Signature + clÃ© whsec_</li>
    <li>Le "shell Stripe" dans le navigateur ne permet pas de tester les webhooks â€” utilisez un vrai paiement test</li>
    <li>Pour appeler un autre endpoint Xano, utilisez une API Request externe (pas d'appel interne)</li>
    <li>Carte de test Stripe : <code>4242 4242 4242 4242</code></li>
</ul>
</div>

<h2>ğŸ§  Quiz rapide</h2>

<p><strong>Question :</strong> Pourquoi ne peut-on pas tester un webhook Stripe directement depuis l'interface Stripe vers Xano ?</p>

<p><strong>RÃ©ponse attendue :</strong> Stripe ne permet plus d'envoyer des webhooks de test depuis l'UI. Le bouton "Envoyer un Ã©vÃ©nement test" redirige vers le CLI Stripe, qui nÃ©cessite une installation locale. La solution en low-code est de faire un vrai paiement test avec la carte <code>4242...</code>.</p>

<h2>ğŸ”— Liens utiles</h2>

<ul>
    <li><a href="https://stripe.com/docs/webhooks" target="_blank">Documentation Stripe - Webhooks</a></li>
    <li><a href="https://stripe.com/docs/webhooks/signatures" target="_blank">Documentation Stripe - VÃ©rification des signatures</a></li>
    <li><a href="https://docs.xano.com/working-with-data/external-api-requests" target="_blank">Documentation Xano - External API Requests</a></li>
    <li><a href="https://developers.brevo.com/" target="_blank">Documentation Brevo API</a></li>
    <li><a href="#" data-article="../articles/xano/integration-stripe-checkout.html">Article prÃ©cÃ©dent : IntÃ©grer Stripe Checkout avec Xano</a></li>
</ul>
