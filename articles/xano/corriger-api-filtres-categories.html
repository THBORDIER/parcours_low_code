<h1>Pourquoi mon API Xano retourne toujours les mÃªmes donnÃ©es ?</h1>

<p><em>Comment corriger les JOINs et filtres pour obtenir des rÃ©sultats filtrÃ©s par catÃ©gorie</em></p>

<!-- Metadata block -->
<div class="metadata">
    <p>ğŸ·ï¸ <strong>CatÃ©gorie:</strong> Xano</p>
    <p>ğŸ¯ <strong>Niveau:</strong> DÃ©butant</p>
    <p>ğŸ” <strong>Mots-clÃ©s:</strong> API, JOINs, Filtres, Xano, Relations, Debugging</p>
    <p>ğŸ“… <strong>Mise Ã  jour:</strong> 19/01/2025</p>
    <p>â±ï¸ <strong>Temps passÃ©:</strong> 20 minutes</p>
    <p>âš™ï¸ <strong>Stack:</strong> Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
âœ… <strong>TL;DR :</strong>
Si votre API Xano retourne toujours les mÃªmes rÃ©sultats peu importe les paramÃ¨tres envoyÃ©s, vÃ©rifiez vos JOINs (liaisons entre tables) et assurez-vous que vos filtres sont appliquÃ©s dans l'onglet <strong>FILTER</strong> principal, pas dans un Add-on.
</div>

<h2>ğŸ¤” ProblÃ¨me rencontrÃ©</h2>

<p><strong>ğŸ›‘ SymptÃ´me :</strong> Votre API retourne toujours les mÃªmes rÃ©parateurs, peu importe la catÃ©gorie que vous envoyez en paramÃ¨tre d'entrÃ©e.</p>

<p><strong>ğŸ’¡ Exemple concret :</strong> Vous crÃ©ez une API qui doit afficher uniquement les plombiers d'un code postal donnÃ©. Mais quand vous testez avec "plombier" ou "Ã©lectricien" en paramÃ¨tre, vous obtenez toujours la liste complÃ¨te de tous les rÃ©parateurs.</p>

<h2>ğŸ” Explication du problÃ¨me</h2>

<p>Dans Xano, pour relier plusieurs tables entre elles, on utilise des <strong>JOINs</strong> (jointures). Ces jointures permettent de combiner les donnÃ©es de diffÃ©rentes tables.</p>

<p><strong>Analogie simple :</strong> Imaginez que vous avez trois boÃ®tes :</p>
<ul>
    <li>ğŸ“¦ <strong>BoÃ®te 1 (repairer)</strong> : contient les noms et adresses des rÃ©parateurs</li>
    <li>ğŸ“¦ <strong>BoÃ®te 2 (repairer_category)</strong> : contient les liens entre les rÃ©parateurs et leurs catÃ©gories</li>
    <li>ğŸ“¦ <strong>BoÃ®te 3 (category)</strong> : contient les noms des catÃ©gories (plombier, Ã©lectricien...)</li>
</ul>

<p>Si vous reliez mal ces boÃ®tes entre elles, Xano ne saura pas quelle catÃ©gorie correspond Ã  quel rÃ©parateur. RÃ©sultat : il vous renvoie tout le monde !</p>

<h2>ğŸ§ª Solution Ã©tape par Ã©tape</h2>

<h3>Ã‰tape 1ï¸âƒ£ : Corriger les JOINs (liaisons entre tables)</h3>

<p>Les jointures doivent suivre la logique suivante :</p>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
    <thead>
        <tr style="background-color: #6C63FF; color: white;">
            <th style="padding: 10px; border: 1px solid #ddd;">Relation</th>
            <th style="padding: 10px; border: 1px solid #ddd;">JOIN Correct</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">repairer â†’ repairer_category</td>
            <td style="padding: 10px; border: 1px solid #ddd;"><code>repairer_category.repairer == repairer.id</code></td>
        </tr>
        <tr style="background-color: #f9f9f9;">
            <td style="padding: 10px; border: 1px solid #ddd;">repairer_category â†’ category</td>
            <td style="padding: 10px; border: 1px solid #ddd;"><code>repairer_category.category == category.id</code></td>
        </tr>
    </tbody>
</table>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
Pour vÃ©rifier si vos JOINs sont corrects, demandez-vous : "Est-ce que je relie bien la clÃ© Ã©trangÃ¨re de la table intermÃ©diaire avec l'ID de la table principale ?"
</div>

<h3>Ã‰tape 2ï¸âƒ£ : Appliquer les filtres au bon endroit</h3>

<p>Les filtres doivent Ãªtre appliquÃ©s dans l'onglet <strong>FILTER</strong> principal de l'API, <strong>pas dans un Add-on</strong> ni aprÃ¨s le Query.</p>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
    <thead>
        <tr style="background-color: #6C63FF; color: white;">
            <th style="padding: 10px; border: 1px solid #ddd;">Champ Ã  filtrer</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Table ciblÃ©e</th>
            <th style="padding: 10px; border: 1px solid #ddd;">Condition</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">Code postal</td>
            <td style="padding: 10px; border: 1px solid #ddd;">repairer</td>
            <td style="padding: 10px; border: 1px solid #ddd;"><code>repairer.zip = input.zip</code></td>
        </tr>
        <tr style="background-color: #f9f9f9;">
            <td style="padding: 10px; border: 1px solid #ddd;">Nom de catÃ©gorie</td>
            <td style="padding: 10px; border: 1px solid #ddd;">category</td>
            <td style="padding: 10px; border: 1px solid #ddd;"><code>category.name = input.categorie_name</code></td>
        </tr>
    </tbody>
</table>

<div class="callout callout-warning">
âš ï¸ <strong>Attention</strong><br>
Si vous appliquez les filtres dans un Add-on <strong>aprÃ¨s</strong> avoir fait le Query, Xano a dÃ©jÃ  rÃ©cupÃ©rÃ© toutes les donnÃ©es. Le filtre n'aura aucun effet sur la requÃªte SQL initiale, et vous obtiendrez toujours tous les rÃ©sultats.
</div>

<h3>Ã‰tape 3ï¸âƒ£ : Tester l'API</h3>

<p>Une fois les corrections appliquÃ©es :</p>
<ol>
    <li>Cliquez sur <strong>Run & Debug</strong> dans Xano</li>
    <li>Entrez un code postal (ex: <code>75001</code>)</li>
    <li>Entrez un nom de catÃ©gorie (ex: <code>plombier</code>)</li>
    <li>VÃ©rifiez que seuls les plombiers du code postal 75001 apparaissent</li>
</ol>

<h2>ğŸ§­ Exemple concret</h2>

<p>Voici la structure de donnÃ©es complÃ¨te :</p>

<pre><code>// Table : repairer
{
  "id": 1,
  "name": "Jean Dupont",
  "zip": "75001"
}

// Table : repairer_category (table de liaison)
{
  "repairer": 1,      // ID du rÃ©parateur
  "category": 5       // ID de la catÃ©gorie
}

// Table : category
{
  "id": 5,
  "name": "plombier"
}
</code></pre>

<p><strong>RequÃªte API correcte :</strong></p>
<pre><code>GET /api/repairers?zip=75001&categorie_name=plombier

// RÃ©sultat attendu : uniquement les plombiers du 75001
</code></pre>

<div class="callout callout-advanced">
ğŸ”¬ <strong>Pour aller plus loin</strong><br>
Si vous avez plusieurs catÃ©gories par rÃ©parateur, vous pouvez utiliser un JOIN de type <strong>LEFT JOIN</strong> pour afficher tous les rÃ©parateurs, mÃªme ceux sans catÃ©gorie. Pensez aussi Ã  ajouter une pagination si votre liste devient longue.
</div>

<!-- Final summary -->
<div class="summary">
ğŸ“Œ <strong>Ã€ retenir :</strong>
<ul>
  <li>Les <strong>JOINs</strong> doivent relier les bonnes clÃ©s entre les tables (clÃ© Ã©trangÃ¨re â†’ ID)</li>
  <li>Les <strong>filtres</strong> doivent Ãªtre appliquÃ©s dans l'onglet <strong>FILTER</strong> principal, pas dans un Add-on</li>
  <li>Testez toujours votre API avec diffÃ©rents paramÃ¨tres pour vÃ©rifier que les filtres fonctionnent</li>
  <li>Si les rÃ©sultats ne changent pas, vÃ©rifiez d'abord les JOINs, puis l'emplacement des filtres</li>
</ul>
</div>

<h2>ğŸ”— Liens utiles</h2>
<ul>
    <li><a href="https://docs.xano.com/working-with-your-database/queries" target="_blank">Documentation Xano : Queries et Joins</a></li>
    <li><a href="https://docs.xano.com/working-with-your-api/filters" target="_blank">Documentation Xano : Filtres</a></li>
</ul>
