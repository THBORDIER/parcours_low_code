<h1>Authentification Xano : Session Cookie vs JWT (Bearer Token)</h1>

<p class="subtitle">Comprendre pourquoi le plugin Xano Auth de WeWeb fonctionne sans header Authorization, et la diffÃ©rence avec l'authentification JWT classique enseignÃ©e dans les cours.</p>

<!-- Metadata block -->
<div class="metadata">
    <p>ğŸ·ï¸ <strong>CatÃ©gorie:</strong> Xano</p>
    <p>ğŸ¯ <strong>Niveau:</strong> AvancÃ©</p>
    <p>ğŸ” <strong>Mots-clÃ©s:</strong> Authentification, JWT, Bearer Token, Session Cookie, Xano Auth, WeWeb, HttpOnly, Include credentials, /login, /me, Authorization header</p>
    <p>ğŸ“… <strong>Mise Ã  jour:</strong> 09/12/2025</p>
    <p>â±ï¸ <strong>Temps passÃ©:</strong> 2h</p>
    <p>âš™ï¸ <strong>Stack:</strong> WeWeb + Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
âœ… <strong>TL;DR :</strong>
WeWeb + Xano Auth utilise des <strong>cookies de session</strong> (HttpOnly), pas des Bearer Tokens. Le cours enseigne JWT classique, mais le plugin gÃ¨re tout automatiquement via cookies. <strong>Pas besoin de header <code>Authorization: Bearer &lt;token&gt;</code></strong> avec cette configuration.
</div>

<h2>ğŸ¤” ProblÃ¨me rencontrÃ©</h2>

<p>En suivant le cours OpenClassrooms sur l'authentification Xano, les instructions demandaient :</p>

<ul>
    <li>SÃ©curiser les endpoints <code>/login</code>, <code>/signup</code>, <code>/me</code></li>
    <li>Stocker le token (<code>authToken</code>) dans une variable WeWeb</li>
    <li>Envoyer un header <code>Authorization: Bearer &lt;token&gt;</code> dans chaque appel API</li>
</ul>

<p><strong>Le problÃ¨me :</strong> AprÃ¨s avoir implÃ©mentÃ© les endpoints cÃ´tÃ© Xano, les API privÃ©es fonctionnaient... <em>sans jamais envoyer de Bearer token</em>. Ã‰tait-ce une erreur ? L'authentification Ã©tait-elle cassÃ©e ?</p>

<p><strong>La rÃ©ponse :</strong> Non, tout fonctionnait correctement. Le plugin Xano Auth de WeWeb utilise un <strong>mode d'authentification diffÃ©rent</strong> de celui enseignÃ© dans le cours.</p>

<h2>ğŸ” Les deux modes d'authentification Xano</h2>

<p>Xano supporte <strong>deux modes d'authentification</strong> distincts :</p>

<table>
    <thead>
        <tr>
            <th>Mode</th>
            <th>Description</th>
            <th>Cas d'utilisation</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>JWT / Bearer Token</strong></td>
            <td>Auth stateless, token stockÃ© cÃ´tÃ© frontend</td>
            <td>Cours Xano classique, apps mobiles, multi-frontend</td>
        </tr>
        <tr>
            <td><strong>Session Cookie</strong></td>
            <td>Auth automatique via cookie HttpOnly</td>
            <td>Plugin Xano Auth WeWeb</td>
        </tr>
    </tbody>
</table>

<div class="callout callout-warning">
âš ï¸ <strong>Attention</strong><br>
Ces deux modes ne sont <strong>pas interchangeables</strong>. Le cours enseigne le mode JWT, mais WeWeb avec le plugin Xano Auth utilise le mode Session Cookie. Les instructions du cours ne s'appliquent donc pas directement.
</div>

<h2>ğŸª Comment fonctionne le mode Session Cookie</h2>

<p>C'est le mode utilisÃ© par le <strong>plugin Xano Auth de WeWeb</strong>. Voici le flux :</p>

<ol>
    <li>L'utilisateur se connecte via le formulaire WeWeb</li>
    <li>Le plugin appelle automatiquement <code>/auth/login</code></li>
    <li>Xano renvoie un <strong>cookie HttpOnly</strong> au navigateur</li>
    <li>WeWeb renvoie automatiquement ce cookie Ã  chaque appel API (grÃ¢ce Ã  <code>Include credentials</code>)</li>
    <li>Xano reconnaÃ®t l'utilisateur <strong>sans jamais voir de Bearer token</strong></li>
    <li>La session persiste mÃªme aprÃ¨s un refresh de page</li>
</ol>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     1. Login      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚             â”‚
â”‚   WeWeb     â”‚                   â”‚    Xano     â”‚
â”‚  (Browser)  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  (Backend)  â”‚
â”‚             â”‚   2. Cookie       â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      HttpOnly     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â–²
       â”‚    3. Appel API + Cookie        â”‚
       â”‚    (automatique)                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

<h3>Avantages du mode Session Cookie</h3>

<ul>
    <li><code>XANO_AUTH.user.*</code> disponible dans toute l'UI WeWeb</li>
    <li>Pas de gestion manuelle du token</li>
    <li>Plus sÃ©curisÃ© : le cookie HttpOnly n'est <strong>pas accessible en JavaScript</strong></li>
    <li>Session persistante automatiquement</li>
</ul>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
Dans WeWeb, vous pouvez accÃ©der aux donnÃ©es utilisateur via <code>XANO_AUTH.user.id</code>, <code>XANO_AUTH.user.email</code>, <code>XANO_AUTH.user.role_name</code>, etc. sans faire d'appel API supplÃ©mentaire.
</div>

<h2>ğŸ” Comment fonctionne le mode JWT/Bearer</h2>

<p>C'est le mode <strong>enseignÃ© dans les cours</strong> et utilisÃ© pour les applications mobiles ou multi-frontend :</p>

<ol>
    <li>L'utilisateur se connecte</li>
    <li><code>/login</code> renvoie un <code>authToken</code> (JWT)</li>
    <li>Le frontend stocke ce token (localStorage, variable, etc.)</li>
    <li>Chaque appel API inclut le header <code>Authorization: Bearer &lt;token&gt;</code></li>
    <li>Le backend vÃ©rifie et dÃ©code le token Ã  chaque requÃªte</li>
</ol>

<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     1. Login      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚             â”‚
â”‚  Frontend   â”‚                   â”‚    Xano     â”‚
â”‚             â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  (Backend)  â”‚
â”‚             â”‚   2. authToken    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      (JWT)        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â–²
       â”‚    3. Authorization: Bearer     â”‚
       â”‚       &lt;token&gt;                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

<h3>Cas d'utilisation du mode JWT/Bearer</h3>

<ul>
    <li>Applications mobiles (React Native, Flutter)</li>
    <li>Architectures multi-frontend</li>
    <li>IntÃ©grations avec des services externes</li>
    <li>APIs consommÃ©es par d'autres backends</li>
</ul>

<h2>âš ï¸ Pourquoi le cours ne correspond pas Ã  ton environnement</h2>

<p>La confusion vient du fait que :</p>

<ul>
    <li>Le cours OpenClassrooms enseigne l'<strong>approche universelle JWT</strong> (valable partout)</li>
    <li>WeWeb + Xano Auth utilise une <strong>approche simplifiÃ©e par cookies</strong> (spÃ©cifique Ã  ce combo)</li>
    <li>Les instructions "stocker le token" et "ajouter Bearer" sont <strong>inutiles</strong> dans ce contexte</li>
</ul>

<div class="callout callout-advanced">
ğŸ”¬ <strong>Pour aller plus loin</strong><br>
Si tu utilises WeWeb sans le plugin Xano Auth (par exemple avec des REST APIs custom), tu devras alors implÃ©menter le mode JWT/Bearer manuellement. Le plugin simplifie Ã©normÃ©ment le processus mais masque cette complexitÃ©.
</div>

<h3>Ce qui a Ã©tÃ© tentÃ© (et pourquoi Ã§a n'a pas marchÃ©)</h3>

<ul>
    <li><strong>Test 1 :</strong> Mettre <code>XANO_AUTH.user.accessToken</code> dans un header Authorization â†’ WeWeb n'autorise pas l'accÃ¨s direct au token du plugin</li>
    <li><strong>Test 2 :</strong> Stocker le token dans une variable WeWeb â†’ Possible, mais inutile car le cookie fait dÃ©jÃ  le travail</li>
    <li><strong>Test 3 :</strong> Appeler des endpoints privÃ©s sans Authorization â†’ Ã‡a fonctionne ! Le cookie de session gÃ¨re tout</li>
</ul>

<h2>ğŸ§ª Ce qui a Ã©tÃ© implÃ©mentÃ© cÃ´tÃ© Xano</h2>

<p>MÃªme si le Bearer token n'est pas nÃ©cessaire cÃ´tÃ© WeWeb, la configuration Xano reste importante pour sÃ©curiser les endpoints.</p>

<h3>Endpoint /auth/login</h3>

<p>Function Stack :</p>

<ol>
    <li><strong>Get Record From user</strong> - RÃ©cupÃ¨re l'utilisateur par email</li>
    <li><strong>PrÃ©condition :</strong> si <code>user == null</code> â†’ retour 401 "Invalid credentials"</li>
    <li><strong>Validate Password</strong> - VÃ©rifie le mot de passe hashÃ©</li>
    <li><strong>PrÃ©condition :</strong> si <code>pass_result == false</code> â†’ retour 401 "Invalid credentials"</li>
    <li><strong>Get Record From role</strong> - RÃ©cupÃ¨re le rÃ´le de l'utilisateur</li>
    <li><strong>Create Authentication Token</strong> - GÃ©nÃ¨re le token/session</li>
</ol>

<h3>Endpoint /auth/me</h3>

<p>Function Stack :</p>

<ol>
    <li><strong>Get Record From user</strong> - RÃ©cupÃ¨re l'utilisateur authentifiÃ©</li>
    <li><strong>Get Record From role</strong> - Joint le rÃ´le associÃ©</li>
    <li><strong>Retourne :</strong> id, firstname, lastname, email, role, role_name, photo, created_at</li>
</ol>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
Les prÃ©conditions dans <code>/login</code> sont essentielles pour la sÃ©curitÃ©. Elles empÃªchent de savoir si c'est l'email ou le mot de passe qui est incorrect (message gÃ©nÃ©rique "Invalid credentials").
</div>

<h2>ğŸ“Œ Ã€ retenir</h2>

<div class="summary">
ğŸ“Œ <strong>Ã€ retenir :</strong>
<ul>
    <li><strong>WeWeb + Xano Auth</strong> = mode Session Cookie (automatique, via cookies HttpOnly)</li>
    <li><strong>Cours OpenClassrooms</strong> = mode JWT/Bearer (manuel, via header Authorization)</li>
    <li>Les deux modes sont <strong>valides</strong>, mais pas interchangeables</li>
    <li>Avec le plugin Xano Auth, <strong>pas besoin</strong> d'envoyer <code>Authorization: Bearer &lt;token&gt;</code></li>
    <li>Le cookie HttpOnly gÃ¨re la session automatiquement et de faÃ§on plus sÃ©curisÃ©e</li>
    <li>Pour accÃ©der aux donnÃ©es utilisateur dans WeWeb : <code>XANO_AUTH.user.*</code></li>
</ul>
</div>

<h2>ğŸ”— Ressources utiles</h2>

<ul>
    <li><a href="https://docs.xano.com/authentication" target="_blank">Documentation Xano - Authentication</a></li>
    <li><a href="https://docs.weweb.io/plugins/xano-auth.html" target="_blank">Documentation WeWeb - Xano Auth Plugin</a></li>
</ul>
