<h1>Intégration des Add-ons Xano pour enrichir les réponses API</h1>

<p><strong>Dans cet article, je vais expliquer comment utiliser les Add-ons Xano pour récupérer automatiquement les données liées sans écrire de SQL, en prenant l'exemple d'une table Reservation enrichie avec les informations de Session, Catégorie, Réparateur et Utilisateur.</strong></p>

<!-- Metadata block -->
<div class="metadata">
    <p>🏷️ <strong>Catégorie:</strong> Xano</p>
    <p>🎯 <strong>Niveau:</strong> Débutant</p>
    <p>🔍 <strong>Mots-clés:</strong> Add-ons Xano, Relations tables, Query enrichment, Reservation API, Foreign keys, Nommage add-ons</p>
    <p>📅 <strong>Mise à jour:</strong> 29/10/2025</p>
    <p>⏱️ <strong>Temps passé:</strong> 1-2 heures</p>
    <p>⚙️ <strong>Stack:</strong> Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
✅ <strong>TL;DR :</strong>
Les Add-ons Xano permettent de joindre automatiquement des données liées sans écrire de SQL. Ils remplacent les JOIN traditionnels et nécessitent une configuration précise : sélection du champ de liaison (clé étrangère), ordre logique des relations, et nommage clair pour une maintenance facile.
</div>

<h2>🤔 Problème rencontré</h2>

<p><strong>🎯 Objectif :</strong> Récupérer dynamiquement toutes les informations liées à une réservation dans Xano : la session associée, la catégorie du réparateur, les détails du réparateur, et l'utilisateur.</p>

<p>Lors de l'intégration, j'ai rencontré plusieurs obstacles :</p>

<p><strong>🚨 Symptômes observés :</strong></p>
<ul>
    <li>Les données liées n'apparaissaient pas dans la réponse API</li>
    <li>Les add-ons étaient techniquement ajoutés, mais le résultat retournait un tableau vide <code>[]</code></li>
    <li>Les noms par défaut générés par Xano (<code>_session_of_repairer_of_repairer_category</code>) étaient illisibles et rendaient difficile la compréhension du modèle de données</li>
</ul>

<div class="callout callout-warning">
⚠️ <strong>Attention</strong><br>
Un add-on qui retourne un tableau vide n'est pas un bug : cela indique un problème de correspondance entre les clés étrangères ou l'absence d'enregistrements correspondants dans la table liée.
</div>

<h2>🔍 Explication simplifiée</h2>

<h3>📚 Qu'est-ce qu'un Add-on dans Xano ?</h3>

<p>Un <strong>Add-on</strong> est une fonctionnalité no-code de Xano qui permet d'enrichir automatiquement une réponse API avec des données provenant de tables liées.</p>

<p><strong>Analogie :</strong> Imaginez que vous consultez une fiche de réservation (Reservation). Cette fiche contient uniquement un numéro de session. Grâce aux Add-ons, vous pouvez automatiquement "dérouler" ce numéro pour obtenir toutes les informations de la session, puis celles de la catégorie, du réparateur, etc., sans avoir à faire plusieurs requêtes séparées.</p>

<div class="callout callout-tip">
✨ <strong>Règle clé</strong><br>
Les Add-ons remplacent totalement les <code>JOIN</code> SQL. Vous n'avez plus besoin d'écrire de requêtes complexes : Xano gère automatiquement les jointures en fonction des relations définies dans votre base de données.
</div>

<h3>🔗 Structure des relations dans notre exemple</h3>

<p>Voici la hiérarchie des relations pour notre table <code>reservation</code> :</p>

<pre><code>reservation
├── session (via reservation.session → session.id)
│   ├── repairer_category (via session.repairer_category_id → repairer_category.id)
│   │   └── category (via repairer_category.category → category.id)
│   └── repairer (via session.repairer_id → repairer.id)
└── user (via reservation.user → user.id)
</code></pre>

<p>Chaque niveau représente un add-on à configurer pour récupérer les données complètes.</p>

<h2>✅ La solution détaillée</h2>

<h3>🎯 Étape 1 : Ajouter l'add-on "Session by Reservation"</h3>

<p><strong>Objectif :</strong> Récupérer les informations de la session liée à chaque réservation.</p>

<p><strong>Configuration :</strong></p>
<ul>
    <li><strong>Champ source :</strong> <code>reservation.session</code> (clé étrangère dans la table reservation)</li>
    <li><strong>Table cible :</strong> <code>session</code></li>
    <li><strong>Champ de liaison :</strong> <code>session.id</code> (clé primaire de la table session)</li>
    <li><strong>Nom de l'add-on :</strong> <code>session_by_reservation</code> (renommé pour plus de clarté)</li>
</ul>

<p>Cet add-on va ajouter un objet <code>session_by_reservation</code> dans la réponse API contenant toutes les informations de la session.</p>

<h3>🔗 Étape 2 : Ajouter l'add-on "Category by Session"</h3>

<p><strong>Objectif :</strong> Récupérer la catégorie du réparateur associée à la session.</p>

<p><strong>Configuration :</strong></p>
<ul>
    <li><strong>Champ source :</strong> <code>session.repairer_category_id</code></li>
    <li><strong>Table cible :</strong> <code>repairer_category</code></li>
    <li><strong>Champ de liaison :</strong> <code>repairer_category.id</code></li>
    <li><strong>Nom de l'add-on :</strong> <code>category_by_session</code></li>
</ul>

<div class="callout callout-tip">
✨ <strong>Astuce</strong><br>
Nommez vos add-ons de manière descriptive en suivant le pattern : <code>[données]_by_[table_source]</code>. Cela facilite grandement la lecture et la maintenance du code côté frontend.
</div>

<h3>🛠️ Étape 3 : Ajouter l'add-on "Category Details"</h3>

<p><strong>Objectif :</strong> Récupérer les détails complets de la catégorie (nom, description, etc.).</p>

<p><strong>Configuration :</strong></p>
<ul>
    <li><strong>Champ source :</strong> <code>repairer_category.category</code></li>
    <li><strong>Table cible :</strong> <code>category</code></li>
    <li><strong>Champ de liaison :</strong> <code>category.id</code></li>
    <li><strong>Nom de l'add-on :</strong> <code>category_details_by_repairer_category</code></li>
</ul>

<h3>🔧 Étape 4 : Ajouter l'add-on "Repairer by Session"</h3>

<p><strong>Objectif :</strong> Récupérer les informations du réparateur associé à la session.</p>

<p><strong>Configuration :</strong></p>
<ul>
    <li><strong>Champ source :</strong> <code>session.repairer_id</code></li>
    <li><strong>Table cible :</strong> <code>repairer</code></li>
    <li><strong>Champ de liaison :</strong> <code>repairer.id</code></li>
    <li><strong>Nom de l'add-on :</strong> <code>repairer_by_session</code></li>
</ul>

<h3>👤 Étape 5 : (Optionnel) Ajouter l'add-on "User by Reservation"</h3>

<p><strong>Objectif :</strong> Récupérer les informations de l'utilisateur qui a créé la réservation.</p>

<p><strong>Configuration :</strong></p>
<ul>
    <li><strong>Champ source :</strong> <code>reservation.user</code></li>
    <li><strong>Table cible :</strong> <code>user</code></li>
    <li><strong>Champ de liaison :</strong> <code>user.id</code></li>
    <li><strong>Nom de l'add-on :</strong> <code>user_by_reservation</code></li>
</ul>

<div class="callout callout-warning">
⚠️ <strong>Point de vigilance</strong><br>
Assurez-vous que les relations entre tables sont correctement définies dans la structure de votre base de données Xano. Si un add-on retourne un tableau vide, vérifiez :
<ul>
    <li>Que les clés étrangères sont bien configurées</li>
    <li>Qu'il existe bien des enregistrements correspondants dans la table cible</li>
    <li>Que le type de données des champs de liaison est cohérent (integer avec integer, etc.)</li>
</ul>
</div>

<h2>🧰 Exemple concret</h2>

<h3>📊 Réponse API enrichie</h3>

<p>Avant l'ajout des add-ons, votre API retournait uniquement les données brutes de la table <code>reservation</code> :</p>

<pre><code>{
  "id": 123,
  "session": 45,
  "user": 78,
  "status": "confirmed",
  "created_at": 1698508800
}
</code></pre>

<p>Après l'ajout des add-ons avec nommage explicite, la réponse devient :</p>

<pre><code>{
  "id": 123,
  "session": 45,
  "user": 78,
  "status": "confirmed",
  "created_at": 1698508800,
  "session_by_reservation": {
    "id": 45,
    "title": "Réparation smartphone",
    "date": "2024-10-30",
    "repairer_category_id": 12,
    "repairer_id": 34
  },
  "category_by_session": {
    "id": 12,
    "category": 5,
    "name": "Électronique"
  },
  "category_details_by_repairer_category": {
    "id": 5,
    "name": "Électronique",
    "description": "Réparation d'appareils électroniques"
  },
  "repairer_by_session": {
    "id": 34,
    "name": "Jean Dupont",
    "email": "jean@example.com",
    "specialization": "Smartphones"
  },
  "user_by_reservation": {
    "id": 78,
    "name": "Marie Martin",
    "email": "marie@example.com"
  }
}
</code></pre>

<p>✅ Vous disposez maintenant d'une réponse API complète et structurée, sans avoir écrit une seule ligne de SQL !</p>

<div class="callout callout-advanced">
🔬 <strong>Pour aller plus loin</strong><br>
<ul>
    <li><strong>Filtres dynamiques :</strong> Vous pouvez combiner les add-ons avec des filtres pour ne récupérer que les réservations d'un utilisateur spécifique ou d'une catégorie donnée.</li>
    <li><strong>Performance :</strong> Les add-ons sont optimisés par Xano et n'impactent pas significativement les performances, même avec plusieurs niveaux de relations.</li>
    <li><strong>Pagination :</strong> Les add-ons fonctionnent parfaitement avec la pagination Query All Records de Xano.</li>
</ul>
</div>

<h2>🔑 Points clés d'amélioration identifiés</h2>

<h3>✨ Clarté des noms d'Add-ons</h3>
<p>Ne gardez jamais les noms générés automatiquement par Xano (type <code>_session_of_repairer_of_repairer_category</code>). Renommez systématiquement vos add-ons avec un pattern clair :</p>
<ul>
    <li><code>session_by_reservation</code> au lieu de <code>_session</code></li>
    <li><code>repairer_by_session</code> au lieu de <code>_repairer_of_session</code></li>
</ul>

<h3>🔗 Organisation logique des relations</h3>
<p>Respectez la hiérarchie naturelle de vos données. Dans notre exemple, la logique est :</p>
<ol>
    <li>Reservation → Session (relation directe)</li>
    <li>Session → Category (via repairer_category)</li>
    <li>Session → Repairer (relation directe)</li>
</ol>

<h3>✅ Validation des données existantes</h3>
<p>Un add-on qui retourne un tableau vide indique systématiquement l'un de ces problèmes :</p>
<ul>
    <li>Clé étrangère mal configurée</li>
    <li>Aucun enregistrement correspondant dans la table cible</li>
    <li>Type de données incohérent entre les champs de liaison</li>
</ul>

<!-- Final summary -->
<div class="summary">
📌 <strong>À retenir :</strong>
<ul>
  <li>Les Add-ons Xano remplacent complètement les JOIN SQL et permettent d'enrichir automatiquement les réponses API</li>
  <li>Chaque add-on nécessite une configuration précise : champ source, table cible, et champ de liaison</li>
  <li>Un nommage clair et explicite est essentiel pour la maintenance et l'utilisation côté frontend</li>
  <li>L'ordre des relations doit respecter la hiérarchie logique de votre modèle de données</li>
  <li>Un add-on vide signale un problème de configuration ou de données, pas un bug Xano</li>
</ul>
</div>

<h2>🧠 Quiz rapide</h2>
<p><strong>Question :</strong> Vous avez un add-on configuré mais il retourne toujours un tableau vide. Quelles sont les 3 premières vérifications à effectuer ?</p>
<details>
    <summary>✅ Voir la réponse</summary>
    <p><strong>Réponse :</strong></p>
    <ul>
        <li><strong>1. Vérifier les clés étrangères :</strong> Assurez-vous que le champ source pointe bien vers la bonne clé primaire de la table cible</li>
        <li><strong>2. Vérifier l'existence des données :</strong> Contrôlez qu'il existe bien des enregistrements correspondants dans la table cible</li>
        <li><strong>3. Vérifier la cohérence des types :</strong> Les champs de liaison doivent avoir le même type de données (integer avec integer, text avec text, etc.)</li>
    </ul>
</details>

<h2>🔗 Liens utiles</h2>
<ul>
    <li><a href="https://docs.xano.com/working-with-your-database/addons" target="_blank">Documentation officielle Xano - Add-ons</a></li>
    <li><a href="https://docs.xano.com/working-with-your-database/database-relationships" target="_blank">Documentation Xano - Relations entre tables</a></li>
    <li><a href="#" data-article="../articles/xano/base-donnees.html">Article connexe : Base de données Xano</a></li>
</ul>
