<h1>Projet 6 : Initiez-vous Ã  la sÃ©curitÃ© et Ã  la gestion des rÃ´les sur votre application</h1>

<!-- Metadata block -->
<div class="metadata">
    <p>ğŸ·ï¸ <strong>CatÃ©gorie:</strong> RÃ©trospectives</p>
    <p>ğŸ¯ <strong>Niveau:</strong> IntermÃ©diaire</p>
    <p>ğŸ” <strong>Mots-clÃ©s:</strong> SÃ©curitÃ©, Middlewares Xano, Stripe signature, Functions Xano, RÃ´les utilisateurs, WeWeb plugins, Authentification, Parsing, Validation webhook</p>
    <p>ğŸ“… <strong>Mise Ã  jour:</strong> 14/01/2026</p>
    <p>â±ï¸ <strong>Temps passÃ©:</strong> 7h</p>
    <p>âš™ï¸ <strong>Stack:</strong> WeWeb + Xano + Stripe</p>
</div>

<!-- TL;DR -->
<div class="tldr">
âœ… <strong>TL;DR :</strong>
Projet de 7h sur la sÃ©curitÃ© et les rÃ´les utilisateurs : middlewares Xano pour contrÃ´ler l'accÃ¨s aux ressources, validation de signature Stripe (5h de galÃ¨re avec le parsing), et dÃ©couverte des functions Xano rÃ©utilisables. Les plugins WeWeb prÃ©-configurÃ©s offrent une excellente base de sÃ©curitÃ©.
</div>

<h2>ğŸ¯ Objectifs du projet</h2>
<p>Ce projet vise Ã  mettre en place une couche de sÃ©curitÃ© solide sur l'application, en contrÃ´lant l'accÃ¨s aux ressources et en validant les webhooks Stripe de maniÃ¨re sÃ©curisÃ©e.</p>

<h2>ğŸ“š Glossaire des termes techniques</h2>

<div class="callout callout-tip">
<strong>ğŸ” Middleware</strong><br>
Un middleware est un composant logiciel qui s'exÃ©cute <strong>avant</strong> le code principal d'une API. Dans Xano, il permet de vÃ©rifier des conditions (ex: l'utilisateur est-il authentifiÃ© ? possÃ¨de-t-il la ressource ?) avant d'autoriser l'accÃ¨s Ã  l'endpoint.
</div>

<div class="callout callout-tip">
<strong>ğŸ­ RÃ´les utilisateurs</strong><br>
Les rÃ´les dÃ©finissent les permissions d'un utilisateur dans l'application (admin, utilisateur standard, invitÃ©, etc.). Chaque rÃ´le possÃ¨de des droits d'accÃ¨s spÃ©cifiques Ã  certaines fonctionnalitÃ©s ou ressources.
</div>

<div class="callout callout-tip">
<strong>ğŸ”‘ Validation de signature (Stripe)</strong><br>
MÃ©canisme de sÃ©curitÃ© qui garantit qu'une requÃªte webhook provient rÃ©ellement de Stripe et n'a pas Ã©tÃ© altÃ©rÃ©e. Stripe envoie une signature cryptographique que l'application doit vÃ©rifier avant de traiter les donnÃ©es.
</div>

<div class="callout callout-tip">
<strong>ğŸ§© Function (Xano)</strong><br>
Une function dans Xano est un bloc de code rÃ©utilisable que vous pouvez appeler depuis plusieurs endpoints. Cela Ã©vite la duplication de code et facilite la maintenance (ex: une function "vÃ©rifier_proprietaire" utilisable partout).
</div>

<div class="callout callout-tip">
<strong>ğŸ”„ Webhook</strong><br>
Un webhook est une notification automatique envoyÃ©e par un service externe (comme Stripe) vers votre API lorsqu'un Ã©vÃ©nement se produit (paiement rÃ©ussi, abonnement annulÃ©, etc.). Votre application doit recevoir et traiter ces notifications de maniÃ¨re sÃ©curisÃ©e.
</div>

<div class="callout callout-tip">
<strong>ğŸ“ Parsing</strong><br>
Le parsing (ou analyse syntaxique) est l'action de dÃ©couper et interprÃ©ter un bloc de texte pour en extraire des informations structurÃ©es. Par exemple : transformer une chaÃ®ne JSON en objet exploitable, ou extraire des valeurs spÃ©cifiques d'un texte brut.
</div>

<div class="callout callout-tip">
<strong>ğŸ”— ConcatÃ©nation</strong><br>
Action de fusionner plusieurs chaÃ®nes de caractÃ¨res en une seule. Exemple : <code>"Bonjour" + " " + "monde"</code> donne <code>"Bonjour monde"</code>.
</div>

<div class="callout callout-tip">
<strong>ğŸ”Œ Plugin</strong><br>
Module d'extension qui ajoute des fonctionnalitÃ©s Ã  une plateforme. Dans WeWeb, les plugins Xano prÃ©-configurent automatiquement les appels API, l'authentification, et les mÃ©canismes de sÃ©curitÃ©.
</div>

<h2>âœ… Ce qui a bien fonctionnÃ©</h2>

<h3>1ï¸âƒ£ Logique de sÃ©curitÃ© intuitive</h3>
<p>Globalement, le projet Ã©tait <strong>trÃ¨s simple</strong> et logique pour moi. Les concepts de sÃ©curitÃ© sont naturels :</p>

<ul>
    <li>âœ… <strong>ContrÃ´ler le possesseur d'un enregistrement</strong> : vÃ©rifier que l'utilisateur connectÃ© est bien propriÃ©taire de la ressource qu'il tente de modifier</li>
    <li>âœ… <strong>S'assurer que c'est le bon compte</strong> avant de valider quoi que ce soit</li>
    <li>âœ… <strong>Principe de moindre privilÃ¨ge</strong> : ne donner accÃ¨s qu'aux ressources strictement nÃ©cessaires</li>
</ul>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
La sÃ©curitÃ© est une question de <strong>bon sens</strong> : "Est-ce que cette personne devrait avoir accÃ¨s Ã  cette ressource ?" Si la rÃ©ponse n'est pas un "oui" clair, alors c'est "non".
</div>

<h3>2ï¸âƒ£ Middlewares : une approche puissante et rÃ©utilisable</h3>
<p>La possibilitÃ© d'<strong>appliquer un middleware sur plusieurs API</strong> est extrÃªmement intÃ©ressante. PlutÃ´t que de rÃ©pÃ©ter le mÃªme code de vÃ©rification dans chaque endpoint, on crÃ©e un middleware une fois et on l'applique partout oÃ¹ c'est nÃ©cessaire.</p>

<p><strong>ğŸ“Š Exemple d'utilisation :</strong></p>
<ul>
    <li>Un middleware "vÃ©rifier_authentification" appliquÃ© sur toutes les API privÃ©es</li>
    <li>Un middleware "vÃ©rifier_proprietaire" appliquÃ© sur les API de modification de profil</li>
    <li>Un middleware "vÃ©rifier_role_admin" appliquÃ© sur les API d'administration</li>
</ul>

<pre><code>// SchÃ©ma conceptuel
RequÃªte â†’ Middleware (vÃ©rifications) â†’ API principale (si autorisÃ©)
                â†“
           Rejet (si non autorisÃ©)
</code></pre>

<div class="callout callout-advanced">
ğŸ”¬ <strong>Pour aller plus loin</strong><br>
Les middlewares peuvent Ãªtre chaÃ®nÃ©s : une requÃªte peut passer par plusieurs middlewares successifs (authentification â†’ vÃ©rification de rÃ´le â†’ vÃ©rification de propriÃ©tÃ©) avant d'atteindre l'API principale.
</div>

<h3>3ï¸âƒ£ Functions Xano : code rÃ©utilisable</h3>
<p>J'ai Ã©galement bien progressÃ© sur les <strong>functions dans Xano</strong>, qui peuvent s'appliquer rapidement sans devoir refaire du code Ã  chaque fois.</p>

<p><strong>Avantages des functions :</strong></p>
<ul>
    <li>âœ… <strong>RÃ©utilisabilitÃ©</strong> : Ã©crire une fois, utiliser partout</li>
    <li>âœ… <strong>MaintenabilitÃ©</strong> : une modification dans la function se propage automatiquement</li>
    <li>âœ… <strong>LisibilitÃ©</strong> : le code principal reste clair et concis</li>
</ul>

<h3>4ï¸âƒ£ Plugins WeWeb : sÃ©curitÃ© intÃ©grÃ©e</h3>
<p>Les <strong>plugins Xano de WeWeb</strong> sont dÃ©jÃ  tous prÃ©-configurÃ©s pour assurer une grosse couche de sÃ©curitÃ©, ce qui fait gagner beaucoup de temps Ã©galement.</p>

<p><strong>SÃ©curitÃ© automatique incluse :</strong></p>
<ul>
    <li>âœ… Gestion automatique du token d'authentification</li>
    <li>âœ… Headers HTTP sÃ©curisÃ©s configurÃ©s par dÃ©faut</li>
    <li>âœ… Refresh automatique des tokens expirÃ©s</li>
    <li>âœ… Protection contre les appels non autorisÃ©s</li>
</ul>

<div class="callout callout-tip">
âœ¨ <strong>Astuce</strong><br>
Profitez de cette sÃ©curitÃ© prÃ©-configurÃ©e ! Ne rÃ©inventez pas la roue en crÃ©ant des systÃ¨mes d'authentification custom quand les plugins font dÃ©jÃ  le travail.
</div>

<h2>ğŸ›‘ DifficultÃ©s rencontrÃ©es</h2>

<h3>â±ï¸ Temps passÃ© : 7h au total</h3>
<ul>
    <li>ğŸ• <strong>5h sur la validation de la clÃ© Stripe</strong> (difficultÃ© principale)</li>
    <li>ğŸ• <strong>~1h sur la mise en marche des middlewares</strong></li>
    <li>ğŸ• <strong>~1h sur le reste</strong> (concepts de sÃ©curitÃ©, tests)</li>
</ul>

<h3>ğŸ” Validation de signature Stripe : un vrai casse-tÃªte</h3>

<p><strong>ğŸ›‘ ProblÃ¨me principal :</strong><br>
Ma principale difficultÃ© rÃ©sidait dans Stripe oÃ¹ je dois :</p>

<ol>
    <li><strong>RÃ©cupÃ©rer des informations</strong> dans un bloc de texte (payload brut du webhook)</li>
    <li><strong>Parser</strong> ce texte pour en extraire les donnÃ©es nÃ©cessaires</li>
    <li><strong>ConcatÃ©ner</strong> plusieurs Ã©lÃ©ments dans un ordre prÃ©cis</li>
    <li><strong>Comparer</strong> le rÃ©sultat Ã  une clÃ© de signature fournie par Stripe</li>
</ol>

<div class="callout callout-warning">
âš ï¸ <strong>ProblÃ¨me technique</strong><br>
La manipulation de ces donnÃ©es n'est <strong>pas possible nativement dans Xano</strong>. Les opÃ©rations de parsing complexe et de cryptographie ne sont pas directement accessibles via l'interface no-code.
</div>

<h3>ğŸ“š Documentation et templates obsolÃ¨tes</h3>

<p><strong>ğŸ›‘ ProblÃ¨mes rencontrÃ©s :</strong></p>
<ul>
    <li>âŒ Les <strong>templates Xano proposÃ©s ne sont pas Ã  jour</strong> avec les derniÃ¨res versions de l'API Stripe</li>
    <li>âŒ La <strong>documentation Xano</strong> sur la validation de signature Stripe est incomplÃ¨te</li>
    <li>âŒ Les exemples fournis ne fonctionnent pas directement</li>
</ul>

<div class="callout callout-warning">
âš ï¸ <strong>RÃ©alitÃ© du terrain</strong><br>
Je n'aurais <strong>pas rÃ©ussi Ã  passer cette phase</strong> sans l'aide d'un autre Ã©lÃ¨ve et de mon mentor. La validation de signature Stripe nÃ©cessite une comprÃ©hension fine des mÃ©canismes cryptographiques que la documentation Xano ne couvre pas suffisamment.
</div>

<h3>ğŸ”§ Solution finalement appliquÃ©e</h3>

<p>GrÃ¢ce Ã  l'aide reÃ§ue, j'ai pu :</p>
<ul>
    <li>âœ… Comprendre le mÃ©canisme exact de validation de signature Stripe</li>
    <li>âœ… Utiliser les bonnes fonctions Xano (ou workarounds) pour le parsing</li>
    <li>âœ… Construire la chaÃ®ne de vÃ©rification dans le bon ordre</li>
    <li>âœ… Valider la signature avant de traiter les Ã©vÃ©nements webhook</li>
</ul>

<pre><code>// Processus de validation (simplifiÃ©)
1. RÃ©cupÃ©rer le payload brut (body) du webhook
2. RÃ©cupÃ©rer le header "Stripe-Signature"
3. Extraire timestamp et signature du header
4. Reconstruire la chaÃ®ne signÃ©e : timestamp + "." + payload
5. Calculer la signature attendue avec la clÃ© secrÃ¨te
6. Comparer signature reÃ§ue vs signature calculÃ©e
7. Si identique â†’ webhook valide, sinon â†’ rejeter
</code></pre>

<div class="callout callout-advanced">
ğŸ”¬ <strong>Pour aller plus loin</strong><br>
La validation de signature Stripe utilise l'algorithme HMAC-SHA256. Stripe signe le webhook avec votre clÃ© secrÃ¨te, et vous devez recalculer la signature de votre cÃ´tÃ© pour vÃ©rifier l'authenticitÃ©. Ce mÃ©canisme empÃªche les attaques par rejeu et les webhooks falsifiÃ©s.
</div>

<h2>ğŸ“Š Bilan de la session</h2>

<div class="summary">
ğŸ“Œ <strong>Ã€ retenir :</strong>
<ul>
    <li>âœ… Les concepts de sÃ©curitÃ© (middlewares, rÃ´les, contrÃ´le d'accÃ¨s) sont <strong>logiques et intuitifs</strong></li>
    <li>âœ… Les <strong>middlewares Xano</strong> sont puissants et rÃ©utilisables sur plusieurs API</li>
    <li>âœ… Les <strong>functions Xano</strong> permettent d'Ã©viter la duplication de code</li>
    <li>âœ… Les <strong>plugins WeWeb</strong> offrent une sÃ©curitÃ© prÃ©-configurÃ©e solide</li>
    <li>âš ï¸ La <strong>validation de signature Stripe</strong> est complexe (5h de travail)</li>
    <li>âš ï¸ La <strong>documentation et templates Xano</strong> ne sont pas Ã  jour sur ce point</li>
    <li>ğŸ¤ L'aide d'autres Ã©lÃ¨ves et du mentor a Ã©tÃ© <strong>essentielle</strong> pour dÃ©bloquer</li>
</ul>
</div>

<h2>ğŸ“ Enseignements clÃ©s</h2>

<h3>1ï¸âƒ£ La sÃ©curitÃ© est une question de bon sens</h3>
<p>Les principes de sÃ©curitÃ© sont naturels : vÃ©rifier l'identitÃ©, contrÃ´ler les accÃ¨s, valider les sources. Si vous comprenez <em>pourquoi</em> c'est nÃ©cessaire, le <em>comment</em> devient Ã©vident.</p>

<h3>2ï¸âƒ£ RÃ©utilisabilitÃ© = gain de temps</h3>
<p>Investir du temps dans des middlewares et functions bien conÃ§us se rentabilise rapidement. Une heure de conception = des dizaines d'heures Ã©conomisÃ©es sur le long terme.</p>

<h3>3ï¸âƒ£ Ne pas hÃ©siter Ã  demander de l'aide</h3>
<p>Certaines problÃ©matiques techniques (comme la validation de signature Stripe) nÃ©cessitent une expertise spÃ©cifique. Bloquer 5h sur un problÃ¨me est normal, mais demander de l'aide plus tÃ´t aurait pu Ã©conomiser du temps.</p>

<h3>4ï¸âƒ£ La documentation n'est pas toujours Ã  jour</h3>
<p>Dans l'Ã©cosystÃ¨me no-code, les API tierces Ã©voluent vite et les templates peuvent devenir obsolÃ¨tes. Toujours croiser plusieurs sources d'information (documentation officielle de Stripe, forums, mentor).</p>

<h2>ğŸš€ Prochaines Ã©tapes</h2>
<ul>
    <li>Appliquer ces mÃ©canismes de sÃ©curitÃ© sur l'ensemble de l'application</li>
    <li>CrÃ©er une library de functions Xano rÃ©utilisables</li>
    <li>Tester les diffÃ©rents scÃ©narios de sÃ©curitÃ© (utilisateur non authentifiÃ©, accÃ¨s non autorisÃ©, etc.)</li>
    <li>Documenter le processus de validation Stripe pour rÃ©fÃ©rence future</li>
</ul>

<div class="callout callout-advanced">
ğŸ”¬ <strong>Pour aller plus loin</strong><br>
Explorez d'autres mÃ©canismes de sÃ©curitÃ© : rate limiting (limitation du nombre de requÃªtes), IP whitelisting (liste blanche d'adresses IP autorisÃ©es), audit logs (journalisation des actions sensibles) pour renforcer encore la sÃ©curitÃ© de votre application.
</div>
