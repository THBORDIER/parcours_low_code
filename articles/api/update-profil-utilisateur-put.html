<h1>Mettre √† jour un profil utilisateur via API PUT sans effacer les donn√©es existantes</h1>

<p class="subtitle">Retour d'exp√©rience sur un pi√®ge courant : comment √©viter de vider les donn√©es d'un profil utilisateur lors d'une mise √† jour partielle avec WeWeb et Xano.</p>

<!-- Metadata block -->
<div class="metadata">
    <p>üè∑Ô∏è <strong>Cat√©gorie:</strong> API</p>
    <p>üéØ <strong>Niveau:</strong> Interm√©diaire</p>
    <p>üîç <strong>Mots-cl√©s:</strong> PUT, PATCH, Edit Record, Ignore empty values, WeWeb Placeholder, User Profile Update, Xano API</p>
    <p>üìÖ <strong>Mise √† jour:</strong> 26/10/2025</p>
    <p>‚è±Ô∏è <strong>Temps pass√©:</strong> 1h30</p>
    <p>‚öôÔ∏è <strong>Stack:</strong> WeWeb + Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
‚úÖ <strong>TL;DR :</strong>
Un endpoint PUT remplace int√©gralement un enregistrement. Si vous envoyez des champs vides depuis WeWeb, Xano les enregistre comme tels et √©crase les donn√©es existantes. Solution : pr√©-remplir les champs avec les vraies valeurs utilisateur et activer "Ignore empty input values" dans Xano.
</div>

<h2>üéØ Objectif de l'article</h2>

<p>Partager une probl√©matique courante rencontr√©e lors du d√©veloppement d'une application web avec WeWeb (front) et Xano (backend no-code) :</p>

<p><strong>Comment mettre √† jour les informations d'un utilisateur sans √©craser ou vider les autres donn√©es de son profil ?</strong></p>

<p>Cet article explique :</p>
<ul>
    <li>Le probl√®me initial rencontr√©</li>
    <li>Les mauvaises pratiques √† √©viter</li>
    <li>Les solutions techniques mises en place</li>
    <li>Le fonctionnement final du syst√®me</li>
    <li>Les pi√®ges potentiels √† anticiper</li>
</ul>

<h2>üî• Probl√®me rencontr√©</h2>

<p>Lorsque j'ai mis en place un endpoint <code>PUT /user/{user_id}</code> pour permettre √† l'utilisateur de modifier son profil (nom, pr√©nom, email), j'ai observ√© un comportement inattendu :</p>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Comportement probl√©matique</strong><br>
Toutes les donn√©es non envoy√©es dans la requ√™te √©taient automatiquement remplac√©es par des valeurs vides ("").
</div>

<p><strong>Pourquoi ce comportement ?</strong></p>
<ul>
    <li><strong>PUT remplace l'ensemble de l'enregistrement</strong> en base de donn√©es (contrairement √† PATCH qui ne modifie que les champs sp√©cifi√©s)</li>
    <li><strong>WeWeb n'envoie pas les placeholder</strong> : ce sont des valeurs d'affichage uniquement, pas des donn√©es r√©elles</li>
    <li><strong>R√©sultat</strong> : si un champ est vide ou non mapp√© correctement ‚Üí Xano re√ßoit du "vide" et l'enregistre</li>
</ul>

<h2>üß† Analyse du probl√®me</h2>

<p>Voici un tableau r√©capitulatif de ce que je pensais vs. la r√©alit√© :</p>

<table>
    <thead>
        <tr>
            <th>√âl√©ment</th>
            <th>Ce que je pensais qu'il faisait</th>
            <th>Ce qu'il fait r√©ellement</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>PUT</strong></td>
            <td>Met √† jour uniquement ce qui change</td>
            <td>Remplace tout l'enregistrement</td>
        </tr>
        <tr>
            <td><strong>Placeholder WeWeb</strong></td>
            <td>Sert de valeur par d√©faut</td>
            <td>Affichage uniquement, non envoy√© dans la requ√™te</td>
        </tr>
        <tr>
            <td><strong>Champ vide</strong></td>
            <td>Ignor√© automatiquement</td>
            <td>Interpr√©t√© comme une valeur vide √† stocker</td>
        </tr>
    </tbody>
</table>

<p>‚û°Ô∏è Il fallait donc emp√™cher l'envoi de valeurs vides ou incompl√®tes.</p>

<h2>üõ†Ô∏è Solution mise en place</h2>

<h3>‚úÖ 1. Utilisation de la valeur existante comme valeur initiale</h3>

<p><strong>Dans WeWeb :</strong></p>

<p>On remplit chaque champ avec la vraie valeur utilisateur (<code>value=user.firstname</code>) et <strong>non un placeholder</strong>.</p>

<p>Ainsi, si l'utilisateur ne change pas un champ, sa valeur est conserv√©e et renvoy√©e dans la requ√™te PUT.</p>

<div class="callout callout-tip">
‚ú® <strong>Astuce</strong><br>
Dans WeWeb, toujours binder les champs de formulaire avec <code>value</code> et non <code>placeholder</code> pour garantir l'envoi des donn√©es existantes.
</div>

<h3>‚úÖ 2. Activation de l'option dans Xano</h3>

<p><strong>Dans la fonction Edit Record du endpoint PUT :</strong></p>

<p>J'ai activ√© l'option suivante :</p>

<div class="callout callout-advanced">
üõ°Ô∏è <strong>Option Xano</strong><br>
"Ignore empty input values (keep existing data)"
<br><br>
Ce qui signifie que Xano NE remplacera PAS un champ si la valeur re√ßue est vide ou absente. Les donn√©es existantes sont conserv√©es.
</div>

<h3>‚úÖ 3. Rafra√Æchissement du profil utilisateur apr√®s mise √† jour</h3>

<p><strong>Apr√®s le PUT :</strong></p>

<ul>
    <li>Un appel <code>login</code> (fetch user) est d√©clench√© automatiquement</li>
    <li>Cela met √† jour les variables utilisateur dans WeWeb</li>
    <li>L'interface se r√©actualise sans rechargement de page</li>
</ul>

<h2>üìå R√©sultat final</h2>

<p>Voici le comportement obtenu apr√®s la mise en place de la solution :</p>

<table>
    <thead>
        <tr>
            <th>Action utilisateur</th>
            <th>Donn√©e envoy√©e √† Xano</th>
            <th>R√©sultat obtenu</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Modifie son pr√©nom</td>
            <td><code>"firstname":"Nouveau"</code></td>
            <td>Pr√©nom mis √† jour ‚úÖ</td>
        </tr>
        <tr>
            <td>Ne touche pas au mot de passe</td>
            <td>Pas de valeur envoy√©e</td>
            <td>Mot de passe conserv√© ‚úÖ</td>
        </tr>
        <tr>
            <td>Supprime volontairement une valeur</td>
            <td><code>"firstname":""</code></td>
            <td>Champ vid√© volontairement ‚úÖ</td>
        </tr>
    </tbody>
</table>

<p><strong>‚ú® Finalit√© :</strong> un syst√®me robuste, flexible et s√©curis√© pour g√©rer les mises √† jour de profil utilisateur.</p>

<h2>‚ö†Ô∏è Probl√®mes potentiels √† √©viter</h2>

<table>
    <thead>
        <tr>
            <th>Probl√®me</th>
            <th>Cause</th>
            <th>Solution</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Donn√©es vides enregistr√©es</td>
            <td>Value non mapp√©e ou champ vide envoy√©</td>
            <td>Pr√©-remplir les champs et activer "Ignore empty values"</td>
        </tr>
        <tr>
            <td>Perte totale d'un profil</td>
            <td>Utilisation du PUT mal configur√©e</td>
            <td>Utiliser PATCH ou merge intelligent</td>
        </tr>
        <tr>
            <td>Mauvaise exp√©rience utilisateur</td>
            <td>Interface non r√©actualis√©e</td>
            <td>Re-fetch des donn√©es apr√®s PUT</td>
        </tr>
    </tbody>
</table>

<h2>üéì Ce que j'ai appris</h2>

<ul>
    <li><strong>Comprendre la diff√©rence entre PUT et PATCH est essentiel</strong> : PUT remplace tout, PATCH ne modifie que ce qui est sp√©cifi√©</li>
    <li><strong>Les placeholders ne remplacent pas de vraies valeurs</strong> : ils sont uniquement visuels dans WeWeb</li>
    <li><strong>Toujours synchroniser les donn√©es locales apr√®s mise √† jour</strong> pour garantir une interface coh√©rente</li>
    <li><strong>Configurer correctement la fonction Edit Record dans Xano change tout</strong> : l'option "Ignore empty values" est cruciale</li>
</ul>

<div class="callout callout-advanced">
üî¨ <strong>Pour aller plus loin</strong><br>
Envisager de passer √† un endpoint <strong>PATCH</strong> personnalis√© pour optimiser encore plus les requ√™tes et n'envoyer que les champs r√©ellement modifi√©s. Cela r√©duit la bande passante et am√©liore les performances.
</div>

<!-- Final summary -->
<div class="summary">
üìå <strong>√Ä retenir :</strong>
<ul>
  <li><strong>PUT remplace tout l'enregistrement</strong>, pas seulement les champs modifi√©s</li>
  <li><strong>Pr√©-remplir les champs de formulaire</strong> avec les vraies valeurs utilisateur (value, pas placeholder)</li>
  <li><strong>Activer "Ignore empty input values"</strong> dans Xano pour pr√©server les donn√©es existantes</li>
  <li><strong>Re-fetch les donn√©es utilisateur</strong> apr√®s mise √† jour pour synchroniser l'interface</li>
  <li><strong>Consid√©rer PATCH</strong> pour des mises √† jour partielles plus optimis√©es</li>
</ul>
</div>

<h2>üöÄ Conclusion</h2>

<p>Ce cas concret montre qu'un comportement ¬´ normal ¬ª d'une API PUT peut entra√Æner des pertes de donn√©es si l'on ne ma√Ætrise pas :</p>

<ul>
    <li>Le fonctionnement des champs dans WeWeb (value vs placeholder)</li>
    <li>La logique de remplacement totale de PUT dans Xano</li>
</ul>

<p>Gr√¢ce √† une bonne configuration et un workflow r√©fl√©chi, j'ai mis en place un syst√®me professionnel de mise √† jour de profil utilisateur <strong>sans risque de perte</strong> et <strong>100% automatis√©</strong>.</p>

<h3>üîú √âtapes suivantes pour am√©liorer encore :</h3>

<ul>
    <li>‚û°Ô∏è Ajouter une validation c√¥t√© front et des messages de succ√®s / erreur</li>
    <li>‚û°Ô∏è Passer √† un endpoint PATCH personnalis√© pour optimiser encore plus</li>
</ul>

<div class="callout callout-tip">
üìò <strong>Documentation</strong><br>
Cet article fait partie d'une base de connaissances pour la formation Low-Code Developer, afin de m√©moriser les bonnes pratiques et √©viter les erreurs futures.
</div>
