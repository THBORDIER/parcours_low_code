<h1>R√©capitulatif Complet ‚Äì Connexion WeWeb / Xano + Filtres Dynamiques</h1>

<p><em>Comment configurer correctement une collection WeWeb connect√©e √† Xano avec des filtres dynamiques, et r√©soudre les probl√®mes courants d'affichage et d'authentification.</em></p>

<!-- Metadata block -->
<div class="metadata">
    <p>üè∑Ô∏è <strong>Cat√©gorie:</strong> WeWeb</p>
    <p>üéØ <strong>Niveau:</strong> Interm√©diaire</p>
    <p>üîç <strong>Mots-cl√©s:</strong> Collections, Xano, Filtres, API, Repeat Items, Workflow, Fetch Collection, Authentification</p>
    <p>üìÖ <strong>Mise √† jour:</strong> 19/10/2025</p>
    <p>‚è±Ô∏è <strong>Temps pass√©:</strong> 1h30</p>
    <p>‚öôÔ∏è <strong>Stack:</strong> WeWeb + Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
‚úÖ <strong>TL;DR :</strong>
Guide complet pour connecter WeWeb √† Xano avec des filtres dynamiques. Vous apprendrez √† configurer les collections, r√©soudre les probl√®mes d'affichage vide, utiliser correctement les conteneurs r√©p√©tables (Repeat Items), et g√©rer l'authentification API. Solutions test√©es pour les erreurs courantes : collection vide, conteneur bloqu√© sur [0], et probl√®me d'API Key.
</div>

<h2>ü§î Probl√®mes rencontr√©s</h2>

<p>Lors de la mise en place d'une connexion WeWeb/Xano avec des filtres dynamiques, plusieurs probl√®mes classiques se sont manifest√©s :</p>

<table>
    <thead>
        <tr>
            <th>Probl√®me</th>
            <th>Description</th>
            <th>Impact</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Collection vide</strong></td>
            <td>WeWeb ne renvoyait aucun √©l√©ment dans <code>repairer_list.data</code></td>
            <td>Impossibilit√© d'afficher les r√©parateurs</td>
        </tr>
        <tr>
            <td><strong>API ne renvoyait rien avec <code>null</code></strong></td>
            <td>Filtrage trop restrictif c√¥t√© Xano</td>
            <td>Pas d'affichage par d√©faut</td>
        </tr>
        <tr>
            <td><strong>Conteneur r√©p√©table affichait [0] seulement</strong></td>
            <td>Mauvaise configuration dans WeWeb</td>
            <td>Affichait toujours un seul √©l√©ment</td>
        </tr>
        <tr>
            <td><strong>Workflow n'actualisait pas l'affichage</strong></td>
            <td>Requ√™te envoy√©e mais collection non rafra√Æchie</td>
            <td>UI fig√©e</td>
        </tr>
        <tr>
            <td><strong>Message d'erreur Xano/WeWeb API Key</strong></td>
            <td>"Failed to init Xano"</td>
            <td>Probl√®me d'authentification externe emp√™chant les requ√™tes</td>
        </tr>
    </tbody>
</table>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Attention</strong><br>
Ces probl√®mes sont souvent li√©s et se manifestent en cascade. Il est important de les r√©soudre dans l'ordre : d'abord l'authentification (API Key), puis la configuration Xano (filtres), et enfin la configuration WeWeb (collections et affichage).
</div>

<h2>üîç Explication simplifi√©e</h2>

<h3>Comment fonctionne la connexion WeWeb ‚Üî Xano ?</h3>

<p>Imaginons WeWeb comme un <strong>tableau de bord visuel</strong> et Xano comme une <strong>base de donn√©es intelligente</strong>. Voici le flux de donn√©es :</p>

<pre><code>Utilisateur (WeWeb UI)
    ‚Üì (change un filtre)
Workflow WeWeb
    ‚Üì (Set Variable + Fetch Collection)
API Xano
    ‚Üì (ex√©cute la requ√™te avec filtres)
Base de donn√©es Xano
    ‚Üì (renvoie les r√©sultats)
Collection WeWeb (repairer_list.data)
    ‚Üì (actualisation automatique)
Conteneur r√©p√©table (affichage UI)
</code></pre>

<h3>Concepts cl√©s</h3>

<ul>
    <li><strong>Collection (WeWeb)</strong> : Connexion √† une API stock√©e dans le Data Layer de WeWeb. Une fois configur√©e, elle se met √† jour automatiquement.</li>
    <li><strong>Repeat Items</strong> : Fonction qui r√©p√®te un conteneur pour chaque √©l√©ment d'une liste (comme une boucle <code>forEach</code>).</li>
    <li><strong>item</strong> : Variable repr√©sentant l'√©l√©ment courant lors d'une r√©p√©tition (ex: <code>item.name</code>, <code>item.zip</code>).</li>
    <li><strong>Fetch Collection</strong> : Action qui d√©clenche l'appel de l'API associ√©e √† une collection pour rafra√Æchir les donn√©es.</li>
    <li><strong>Ignore empty values (Xano)</strong> : Option qui supprime les champs vides de la requ√™te automatiquement, permettant des filtres optionnels.</li>
</ul>

<div class="callout callout-tip">
‚ú® <strong>Astuce</strong><br>
La cl√© d'une int√©gration r√©ussie est de comprendre que <strong>WeWeb ne stocke pas les donn√©es</strong>, il les affiche. C'est Xano qui fait le travail de filtrage et de requ√™te. WeWeb est juste un "miroir intelligent" qui se met √† jour quand vous appelez <code>Fetch Collection</code>.
</div>

<h2>üß™ Solution / Proc√©dure</h2>

<h3>√âtape 1Ô∏è‚É£ : Configuration c√¥t√© Xano</h3>

<p>Voici les actions √† mettre en place dans votre API Xano :</p>

<table>
    <thead>
        <tr>
            <th>Action</th>
            <th>But</th>
            <th>R√©sultat</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Activation de <strong>"Ignore empty values"</strong> dans les filtres</td>
            <td>Permettre les valeurs <code>null</code></td>
            <td>L'API renvoie tous les enregistrements si aucun filtre n'est fourni</td>
        </tr>
        <tr>
            <td>Utilisation de <strong>JOIN</strong> et <strong>Custom Query</strong> propres</td>
            <td>Filtrage par zip, categorie_name, dates</td>
            <td>API dynamique et flexible</td>
        </tr>
        <tr>
            <td>V√©rification des permissions de l'API Key</td>
            <td>Autoriser WeWeb √† interroger l'API</td>
            <td>Authentification fonctionnelle</td>
        </tr>
    </tbody>
</table>

<div class="callout callout-advanced">
üî¨ <strong>Pour aller plus loin</strong><br>
Dans Xano, vous pouvez activer "Ignore empty values" directement dans les param√®tres de chaque input de votre endpoint. Cela permet de cr√©er des filtres totalement optionnels : si l'utilisateur ne s√©lectionne rien, le filtre n'est tout simplement pas appliqu√©.
</div>

<h3>√âtape 2Ô∏è‚É£ : Configuration c√¥t√© WeWeb</h3>

<p>Voici les actions √† mettre en place dans WeWeb :</p>

<table>
    <thead>
        <tr>
            <th>Action</th>
            <th>But</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>D√©claration de <strong>variables</strong> (zip, categorie_name, start_date, end_date)</td>
            <td>Centraliser les filtres et les rendre accessibles partout</td>
        </tr>
        <tr>
            <td>Utilisation de <strong>Fetch Collection</strong> dans les workflows</td>
            <td>Rafra√Æchir dynamiquement les donn√©es apr√®s un changement de filtre</td>
        </tr>
        <tr>
            <td>Configuration <strong>Repeat Items</strong> = <code>{{ collections.repairer_list.data }}</code></td>
            <td>Activer le rendu dynamique du conteneur</td>
        </tr>
        <tr>
            <td>Utilisation de <code>item.fieldname</code> √† l'int√©rieur des conteneurs</td>
            <td>Affichage correct par √©l√©ment (ex: <code>item.name</code>, <code>item.email</code>)</td>
        </tr>
    </tbody>
</table>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Attention : erreur classique</strong><br>
Si votre conteneur r√©p√©table affiche <code>[0]</code> au lieu des vraies valeurs, c'est que vous avez probablement configur√© <strong>Repeat Items</strong> avec la mauvaise source. Assurez-vous d'utiliser <code>collections.repairer_list.data</code> et non <code>collections.repairer_list</code> (qui est l'objet complet, pas juste le tableau de donn√©es).
</div>

<h3>√âtape 3Ô∏è‚É£ : Configuration des workflows (filtre dynamique)</h3>

<p>Voici le fonctionnement d'un workflow de filtre complet :</p>

<ol>
    <li><strong>L'utilisateur change un filtre</strong> (ex: s√©lectionne une cat√©gorie dans une selectbox)</li>
    <li><strong>Workflow se d√©clenche</strong> sur l'√©v√©nement <code>onChange</code></li>
    <li><strong>Action 1 : Set Variable</strong><br>
        Exemple : <code>categorie_name = $event.value</code><br>
        Cela met √† jour la variable qui sera envoy√©e √† Xano
    </li>
    <li><strong>Action 2 : Fetch Collection</strong><br>
        Collection : <code>repairer_list</code><br>
        Cela force WeWeb √† rappeler l'API Xano avec les nouvelles valeurs
    </li>
    <li><strong>La collection interroge Xano</strong> avec les param√®tres mis √† jour</li>
    <li><strong>Le conteneur r√©p√©table se met √† jour automatiquement</strong> gr√¢ce √† la liaison r√©active</li>
</ol>

<div class="callout callout-tip">
‚ú® <strong>Astuce UX</strong><br>
Pour am√©liorer l'exp√©rience utilisateur, vous pouvez ajouter un indicateur de chargement (<code>loading state</code>) pendant que la collection se rafra√Æchit. WeWeb propose des variables automatiques comme <code>collections.repairer_list.isFetching</code> que vous pouvez utiliser pour afficher un spinner.
</div>

<h2>üß∞ R√©solution du probl√®me d'API Key</h2>

<p>Si vous rencontrez le message :</p>

<pre><code>"Failed to init Xano, please ensure your API key has the permission required."
</code></pre>

<h3>üîç Causes possibles :</h3>

<ul>
    <li>La cl√© API dans WeWeb a expir√© ou √©t√© supprim√©e c√¥t√© Xano</li>
    <li>Mise √† jour des permissions dans Xano (acc√®s restreint)</li>
    <li>Vous n'avez pas activ√© l'API dans le bon "API Group" (ex. <code>public</code> ou <code>users</code>)</li>
    <li>Le header d'authentification a √©t√© modifi√© (ex: <code>X-API-Key</code>)</li>
</ul>

<h3>üõ†Ô∏è Solution recommand√©e :</h3>

<p><strong>Dans Xano :</strong></p>
<ol>
    <li>Allez dans <strong>Settings ‚Üí API Keys</strong></li>
    <li>V√©rifiez si la cl√© est toujours <strong>active</strong></li>
    <li>V√©rifiez les <strong>permissions</strong> (lecture, ex√©cution)</li>
    <li>V√©rifiez le bon <strong>API Group</strong> (souvent <code>public</code> pour les endpoints non authentifi√©s)</li>
</ol>

<p><strong>Dans WeWeb :</strong></p>
<ol>
    <li>Allez dans <strong>Data Sources</strong></li>
    <li><strong>Reconnectez</strong> la source Xano en entrant √† nouveau la cl√© API</li>
    <li>V√©rifiez que l'<strong>API Group</strong> est correct</li>
    <li>Testez la connexion en appelant un endpoint simple</li>
</ol>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>S√©curit√©</strong><br>
Ne partagez jamais votre API Key publiquement. Si vous travaillez avec Git, assurez-vous de ne pas commit vos cl√©s dans le code. WeWeb stocke ces cl√©s de mani√®re s√©curis√©e dans ses param√®tres.
</div>

<h2>üß≠ Exemple concret : le workflow de filtre complet</h2>

<p>Imaginons un syst√®me de recherche de r√©parateurs avec 3 filtres :</p>

<h3>Configuration WeWeb</h3>

<p><strong>Variables cr√©√©es :</strong></p>
<pre><code>zip : null (text)
categorie_name : null (text)
start_date : null (date)
</code></pre>

<p><strong>Collection configur√©e :</strong></p>
<pre><code>Nom : repairer_list
Endpoint Xano : /api/repairers
Query parameters :
  - zip: {{ variables.zip }}
  - categorie_name: {{ variables.categorie_name }}
  - start_date: {{ variables.start_date }}
</code></pre>

<p><strong>Workflow sur le selectbox "Cat√©gorie" :</strong></p>
<pre><code>Trigger : onChange
Actions :
  1. Set Variable
     - Variable: categorie_name
     - Value: {{ $event.value }}

  2. Fetch Collection
     - Collection: repairer_list
</code></pre>

<h3>Configuration Xano</h3>

<p><strong>Endpoint : GET /api/repairers</strong></p>
<pre><code>Inputs :
  - zip (text) : "Ignore empty values" ‚úì
  - categorie_name (text) : "Ignore empty values" ‚úì
  - start_date (date) : "Ignore empty values" ‚úì

Query :
  SELECT * FROM repairers
  WHERE (zip = $zip OR $zip IS NULL)
    AND (category = $categorie_name OR $categorie_name IS NULL)
    AND (available_from >= $start_date OR $start_date IS NULL)
</code></pre>

<div class="callout callout-tip">
‚ú® <strong>Astuce SQL</strong><br>
La condition <code>(field = $param OR $param IS NULL)</code> est un pattern classique pour cr√©er des filtres optionnels en SQL. Combin√©e avec "Ignore empty values" de Xano, elle permet une API ultra-flexible.
</div>

<h2>üß† Glossaire des termes</h2>

<table>
    <thead>
        <tr>
            <th>Terme</th>
            <th>D√©finition</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Collection (WeWeb)</strong></td>
            <td>Connexion √† une API stock√©e dans le Data Layer de WeWeb</td>
        </tr>
        <tr>
            <td><strong>Repeat Items</strong></td>
            <td>Fonction qui r√©p√®te un conteneur pour chaque √©l√©ment d'une liste</td>
        </tr>
        <tr>
            <td><strong>item</strong></td>
            <td>Variable repr√©sentant l'√©l√©ment courant lors d'une r√©p√©tition</td>
        </tr>
        <tr>
            <td><strong>Fetch Collection</strong></td>
            <td>Action qui d√©clenche l'appel de l'API associ√©e</td>
        </tr>
        <tr>
            <td><strong>Request (WeWeb)</strong></td>
            <td>Action API isol√©e (non li√©e √† une collection automatique)</td>
        </tr>
        <tr>
            <td><strong>Ignore empty values (Xano)</strong></td>
            <td>Option qui supprime les champs vides de la requ√™te automatiquement</td>
        </tr>
        <tr>
            <td><strong>API Key</strong></td>
            <td>Cl√© d'authentification pour s√©curiser l'acc√®s √† Xano depuis WeWeb</td>
        </tr>
    </tbody>
</table>

<!-- Final summary -->
<div class="summary">
üìå <strong>√Ä retenir :</strong>
<ul>
    <li><strong>Xano</strong> : Activez "Ignore empty values" pour permettre les filtres optionnels, et configurez correctement les permissions de l'API Key</li>
    <li><strong>WeWeb</strong> : Utilisez des variables centralis√©es, <code>Fetch Collection</code> dans les workflows, et configurez <code>Repeat Items</code> avec <code>collections.nom.data</code></li>
    <li><strong>Workflow de filtre</strong> : Set Variable ‚Üí Fetch Collection ‚Üí Actualisation automatique du conteneur</li>
    <li><strong>Debugging</strong> : Si la collection est vide, v√©rifiez d'abord l'API Key, puis les filtres Xano, puis la configuration WeWeb</li>
    <li><strong>Repeat Items</strong> : Toujours utiliser <code>item.fieldname</code> √† l'int√©rieur, et pointer vers <code>collections.nom.data</code> (pas juste <code>collections.nom</code>)</li>
</ul>
</div>

<h2>üß≠ D√©fis restants et prochaines √©tapes</h2>

<table>
    <thead>
        <tr>
            <th>D√©fi</th>
            <th>Prochaines √©tapes recommand√©es</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Filtre "Cat√©gorie d'objet" ne fonctionne pas</td>
            <td>V√©rifier si la valeur envoy√©e correspond <strong>exactement</strong> √† ce que Xano attend (string / ID / slug). Utiliser le debugger Xano pour inspecter les requ√™tes.</td>
        </tr>
        <tr>
            <td>Erreur API Key</td>
            <td>Reconnecter la source Xano dans WeWeb (Data Sources ‚Üí Xano ‚Üí Re-authenticate)</td>
        </tr>
        <tr>
            <td>Am√©lioration UX</td>
            <td>Ajouter un bouton "Rechercher" ou un indicateur de chargement (<code>isFetching</code>) pour am√©liorer le feedback utilisateur</td>
        </tr>
    </tbody>
</table>

<h2>üéâ Conclusion</h2>

<p><strong>‚úÖ Ce qui a √©t√© mis en place :</strong></p>
<ul>
    <li>Une API dynamique avec filtres optionnels c√¥t√© Xano</li>
    <li>Un affichage automatique c√¥t√© WeWeb avec conteneur r√©p√©table</li>
    <li>Des workflows efficaces qui rafra√Æchissent les donn√©es en temps r√©el</li>
</ul>

<p><strong>üîí Ce qui reste √† finaliser :</strong></p>
<ul>
    <li>La reconnection API Key (si l'erreur persiste)</li>
    <li>Le mapping exact du filtre cat√©gorie (valider le format attendu)</li>
    <li>L'am√©lioration de l'exp√©rience utilisateur avec un feedback visuel</li>
</ul>

<div class="callout callout-advanced">
üî¨ <strong>Pour aller plus loin</strong><br>
Une fois cette base fonctionnelle, vous pourrez explorer des concepts avanc√©s comme la <strong>pagination</strong> (pour g√©rer de grandes listes), le <strong>debouncing</strong> (pour limiter les appels API lors de la saisie), ou encore la <strong>mise en cache</strong> des r√©sultats pour am√©liorer les performances.
</div>

<h2>üîó Liens utiles</h2>

<ul>
    <li><a href="https://docs.weweb.io/data/collections.html" target="_blank">Documentation WeWeb - Collections</a></li>
    <li><a href="https://docs.weweb.io/workflows/actions.html" target="_blank">Documentation WeWeb - Workflows</a></li>
    <li><a href="https://docs.xano.com/api-reference/query-filtering" target="_blank">Documentation Xano - Query Filtering</a></li>
    <li><a href="https://docs.xano.com/authentication/api-keys" target="_blank">Documentation Xano - API Keys</a></li>
</ul>
