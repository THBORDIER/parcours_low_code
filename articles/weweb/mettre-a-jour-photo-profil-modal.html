<h1>Mettre √† jour la photo de profil utilisateur via un modal WeWeb</h1>

<p>
Dans cet article, je vais t'expliquer comment permettre √† un utilisateur de changer sa photo de profil depuis une fen√™tre modale (popup) dans WeWeb, puis envoyer automatiquement la nouvelle URL √† ton API Xano pour mettre √† jour le champ <code>profile_photo_path</code> dans la table <code>user</code>.
</p>

<!-- Metadata block -->
<div class="metadata">
    <p>üè∑Ô∏è <strong>Cat√©gorie :</strong> WeWeb</p>
    <p>üéØ <strong>Niveau :</strong> D√©butant</p>
    <p>üîç <strong>Mots-cl√©s :</strong> Modal, Variable bidirectionnelle, Xano API, PUT Request, profile_photo_path, WeWeb v3, Binding, Workflow, currentUser</p>
    <p>üìÖ <strong>Mise √† jour :</strong> 04/11/2025</p>
    <p>‚è±Ô∏è <strong>Temps pass√© :</strong> 1h-2h</p>
    <p>‚öôÔ∏è <strong>Stack :</strong> WeWeb + Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
‚úÖ <strong>TL;DR :</strong>
Pour mettre √† jour une photo de profil depuis un modal WeWeb, cr√©e une variable de page (ex: <code>newPhotoURL</code>), lie-la au champ texte du modal, puis configure un workflow avec une action Xano Request (PUT) qui envoie la nouvelle URL √† ton API.
</div>

<h2>ü§î Probl√®me rencontr√©</h2>

<p>
Tu voulais permettre √† un utilisateur de changer sa photo de profil depuis une fen√™tre modale (popup) dans WeWeb, puis envoyer automatiquement la nouvelle URL √† ton API Xano pour mettre √† jour le champ <code>profile_photo_path</code> dans la table <code>user</code>.
</p>

<p><strong>üí° Contexte utilisateur :</strong></p>
<p>
L'utilisateur clique sur "Modifier ma photo", un modal s'ouvre avec un champ texte pour coller l'URL de la nouvelle photo, puis il clique sur "Sauvegarder". La photo devrait se mettre √† jour imm√©diatement dans l'interface et dans la base de donn√©es Xano.
</p>

<h3>‚öôÔ∏è Difficult√©s rencontr√©es</h3>

<p>Cependant, plusieurs obstacles emp√™chaient le bon fonctionnement :</p>

<table>
    <thead>
        <tr>
            <th>Difficult√©</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>1Ô∏è‚É£ Mauvais type d'action</strong></td>
            <td>L'action WeWeb <code>new_profile_path</code> utilisait le type "Return a value" au lieu d'un appel API Xano. Aucun appel r√©el n'√©tait ex√©cut√©.</td>
        </tr>
        <tr>
            <td><strong>2Ô∏è‚É£ Changements WeWeb v3</strong></td>
            <td>L'option "Value" du champ input n'existe plus directement. WeWeb v3 repose sur des <strong>variables</strong> et des <strong>bindings</strong> pour lier les donn√©es.</td>
        </tr>
        <tr>
            <td><strong>3Ô∏è‚É£ Absence de liaison</strong></td>
            <td>La donn√©e saisie par l'utilisateur dans le modal n'√©tait pas transmise √† la requ√™te Xano.</td>
        </tr>
    </tbody>
</table>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Attention : WeWeb v3 a chang√© la gestion des formulaires</strong><br>
Dans WeWeb v3, les options "Get data from component" ont √©t√© d√©plac√©es. Le syst√®me repose d√©sormais sur des <strong>variables de page</strong> et des <strong>bindings bidirectionnels</strong> pour lier les champs de formulaire aux workflows.
</div>

<h2>üîç Explication simplifi√©e</h2>

<p>
Pour comprendre comment √ßa fonctionne, imagine une <strong>bo√Æte √† lettres</strong> (la variable) qui re√ßoit et stocke temporairement l'URL de la photo.
</p>

<ul>
    <li><strong>La variable</strong> (<code>newPhotoURL</code>) : C'est une "bo√Æte" qui stocke l'URL saisie par l'utilisateur.</li>
    <li><strong>Le binding</strong> : C'est le "fil" qui relie le champ texte du modal √† cette bo√Æte. Quand l'utilisateur tape, la valeur dans la bo√Æte change automatiquement.</li>
    <li><strong>Le workflow</strong> : C'est la "proc√©dure d'envoi" qui prend le contenu de la bo√Æte et l'envoie √† Xano via une requ√™te PUT.</li>
</ul>

<h3>üß† Concepts cl√©s</h3>

<p><strong>Variable de page :</strong></p>
<p>
Une variable locale √† ta page WeWeb, qui stocke temporairement des donn√©es. Elle peut √™tre li√©e √† des √©l√©ments d'interface (inputs, images, etc.) et utilis√©e dans des workflows.
</p>

<p><strong>Binding bidirectionnel :</strong></p>
<p>
Quand tu lies un champ texte √† une variable, les changements dans le champ mettent automatiquement √† jour la variable, et vice-versa. C'est ce qui permet de r√©cup√©rer facilement la valeur saisie.
</p>

<p><strong>Workflow avec actions Xano :</strong></p>
<p>
Un workflow est une s√©rie d'actions d√©clench√©es par un √©v√©nement (ex: clic sur un bouton). Pour appeler ton API Xano, tu dois utiliser une action de type "Xano Request", pas "Return a value".
</p>

<h2>‚úÖ Solution / Proc√©dure compl√®te</h2>

<h3>√âtape 1Ô∏è‚É£ : Configuration de l'endpoint Xano</h3>

<p>Dans Xano, cr√©e ou configure un endpoint pour mettre √† jour la photo de profil :</p>

<ul>
    <li><strong>Type :</strong> <code>PUT</code></li>
    <li><strong>Path :</strong> <code>/user/{user_id}/profile_photo_path</code></li>
    <li><strong>Inputs :</strong>
        <ul>
            <li><code>user_id</code> (integer, path parameter)</li>
            <li><code>profile_photo_path</code> (text, body parameter)</li>
        </ul>
    </li>
    <li><strong>Retour :</strong> <code>updated_user</code> (l'objet utilisateur mis √† jour)</li>
</ul>

<p><strong>Exemple de body attendu par Xano :</strong></p>
<pre><code>{
  "profile_photo_path": "https://example.com/new-photo.jpg"
}
</code></pre>

<h3>√âtape 2Ô∏è‚É£ : Cr√©er la variable WeWeb</h3>

<p>Dans WeWeb, cr√©e une variable de page pour stocker l'URL saisie :</p>

<ol>
    <li>Ouvre le panneau <strong>Variables</strong> (ic√¥ne <code>{x}</code> dans la barre lat√©rale)</li>
    <li>Clique sur <strong>Add variable</strong></li>
    <li>Configure :
        <ul>
            <li><strong>Name :</strong> <code>newPhotoURL</code></li>
            <li><strong>Type :</strong> Text</li>
            <li><strong>Scope :</strong> Page (local √† ta page)</li>
            <li><strong>Default value :</strong> Laisse vide ou mets une URL de placeholder</li>
        </ul>
    </li>
</ol>

<div class="callout callout-tip">
‚ú® <strong>Astuce : Pr√©visualisation en temps r√©el</strong><br>
Tu peux lier cette variable √† un √©l√©ment <code>&lt;img&gt;</code> pour afficher une pr√©visualisation de la photo pendant que l'utilisateur tape l'URL dans le champ texte. √áa am√©liore l'exp√©rience utilisateur !
</div>

<h3>√âtape 3Ô∏è‚É£ : Lier le champ texte du modal √† la variable</h3>

<p>Maintenant, lie le champ texte de ton modal √† la variable <code>newPhotoURL</code> :</p>

<ol>
    <li>S√©lectionne le <strong>champ texte</strong> (input) dans ton modal</li>
    <li>Dans le panneau de propri√©t√©s, trouve la section <strong>Bindings</strong></li>
    <li>Pour le champ <strong>Value</strong>, clique sur l'ic√¥ne de binding (üîó)</li>
    <li>S√©lectionne <code>{{ newPhotoURL }}</code> dans la liste des variables</li>
    <li>Active l'option <strong>Bidirectional binding</strong> si disponible (permet la mise √† jour automatique dans les deux sens)</li>
</ol>

<p><strong>R√©sultat :</strong> Quand l'utilisateur tape dans le champ, la variable <code>newPhotoURL</code> se met automatiquement √† jour.</p>

<h3>√âtape 4Ô∏è‚É£ : Configurer le workflow du bouton "Sauvegarder"</h3>

<p>Sur le bouton "Sauvegarder" de ton modal, configure un workflow avec 3 actions :</p>

<h4>Action 1 : Appel API Xano (PUT Request)</h4>
<ul>
    <li><strong>Type :</strong> Xano ‚Üí Request</li>
    <li><strong>Endpoint :</strong> <code>new_profile_path</code> (ou le nom que tu as donn√© dans WeWeb)</li>
    <li><strong>Param√®tres :</strong>
        <ul>
            <li><code>user_id</code> : <code>{{ currentUser.id }}</code></li>
            <li><code>profile_photo_path</code> : <code>{{ newPhotoURL }}</code></li>
        </ul>
    </li>
</ul>

<h4>Action 2 : Fermer le modal</h4>
<ul>
    <li><strong>Type :</strong> Navigate ‚Üí Close all popups</li>
    <li><strong>Effet :</strong> Ferme automatiquement la fen√™tre modale apr√®s l'enregistrement</li>
</ul>

<h4>Action 3 (Optionnel) : Mettre √† jour l'affichage imm√©diatement</h4>
<ul>
    <li><strong>Type :</strong> Variable ‚Üí Change variable value</li>
    <li><strong>Variable :</strong> <code>currentUser.profile_photo_path</code></li>
    <li><strong>Nouvelle valeur :</strong> <code>{{ newPhotoURL }}</code></li>
    <li><strong>Effet :</strong> L'image de profil se met √† jour instantan√©ment sans recharger la page</li>
</ul>

<div class="callout callout-advanced">
üî¨ <strong>Pour aller plus loin : Gestion des erreurs</strong><br>
Ajoute une action conditionnelle pour v√©rifier si la requ√™te Xano a r√©ussi. Si elle √©choue, affiche un message d'erreur √† l'utilisateur et ne ferme pas le modal. Utilise <code>{{ action.result.success }}</code> comme condition.
</div>

<h3>√âtape 5Ô∏è‚É£ : Tester le workflow</h3>

<ol>
    <li>Ouvre le modal</li>
    <li>Colle une URL d'image dans le champ texte (ex: <code>https://i.pravatar.cc/300</code>)</li>
    <li>Clique sur "Sauvegarder"</li>
    <li>V√©rifie dans la <strong>console r√©seau</strong> (F12 ‚Üí Network) qu'une requ√™te <code>PUT</code> est envoy√©e √† Xano</li>
    <li>V√©rifie que le champ <code>profile_photo_path</code> est bien mis √† jour dans ta table <code>user</code> dans Xano</li>
</ol>

<h2>üß∞ Exemple concret</h2>

<p><strong>Requ√™te envoy√©e √† Xano :</strong></p>

<pre><code>PUT /api:v1/user/42/profile_photo_path

Headers:
  Authorization: Bearer &lt;authtoken&gt;
  Content-Type: application/json

Body:
{
  "profile_photo_path": "https://i.pravatar.cc/300"
}
</code></pre>

<p><strong>R√©ponse de Xano :</strong></p>

<pre><code>{
  "id": 42,
  "email": "user@example.com",
  "profile_photo_path": "https://i.pravatar.cc/300",
  "updated_at": 1699027200000
}
</code></pre>

<p><strong>Workflow WeWeb (r√©sum√© visuel) :</strong></p>

<pre><code>1. User clicks "Modifier ma photo"
   ‚Üì
2. Modal opens with input field (bound to {{ newPhotoURL }})
   ‚Üì
3. User pastes URL ‚Üí {{ newPhotoURL }} updates automatically
   ‚Üì
4. User clicks "Sauvegarder"
   ‚Üì
5. Action 1: Xano PUT request
      - user_id: {{ currentUser.id }}
      - profile_photo_path: {{ newPhotoURL }}
   ‚Üì
6. Action 2: Close modal
   ‚Üì
7. Action 3: Update {{ currentUser.profile_photo_path }} (optional)
   ‚Üì
8. Photo updates in UI ‚úÖ
</code></pre>

<h2>üìå √Ä retenir</h2>

<div class="summary">
üìå <strong>√Ä retenir :</strong>
<ul>
  <li><strong>WeWeb v3 utilise des variables et des bindings</strong> pour lier les champs de formulaire aux workflows, pas l'ancienne option "Value" directe.</li>
  <li><strong>Cr√©e toujours une variable de page</strong> pour stocker temporairement les donn√©es saisies par l'utilisateur avant de les envoyer √† l'API.</li>
  <li><strong>Utilise un binding bidirectionnel</strong> pour synchroniser automatiquement le champ texte et la variable.</li>
  <li><strong>Configure une action Xano Request (PUT)</strong> dans le workflow, pas "Return a value" qui ne fait qu'un retour local.</li>
  <li><strong>Ferme le modal apr√®s succ√®s</strong> avec "Close all popups" pour une meilleure exp√©rience utilisateur.</li>
</ul>
</div>

<h2>üß† Quiz rapide</h2>

<p><strong>Question :</strong> Pourquoi doit-on cr√©er une variable de page plut√¥t que d'acc√©der directement √† la valeur du champ texte dans le workflow ?</p>

<details>
    <summary>‚úÖ Voir la r√©ponse</summary>
    <p><strong>R√©ponse :</strong></p>
    <ul>
        <li>Dans WeWeb v3, les workflows n'ont pas d'acc√®s direct √† la valeur des champs de formulaire sans binding.</li>
        <li>La variable de page sert d'<strong>interm√©diaire</strong> entre l'interface (input) et le backend (API).</li>
        <li>Elle permet aussi de <strong>r√©utiliser</strong> la valeur dans plusieurs actions du workflow (ex: pr√©visualisation, validation, envoi).</li>
        <li>C'est une bonne pratique pour s√©parer la logique d'interface et la logique m√©tier.</li>
    </ul>
</details>

<h2>üîó Liens utiles</h2>

<ul>
    <li><a href="https://docs.weweb.io/variables.html" target="_blank">Documentation WeWeb : Variables</a></li>
    <li><a href="https://docs.weweb.io/workflows.html" target="_blank">Documentation WeWeb : Workflows</a></li>
    <li><a href="https://docs.xano.com/api-endpoints/put-requests" target="_blank">Documentation Xano : PUT Requests</a></li>
    <li><a href="https://docs.weweb.io/xano-integration.html" target="_blank">Documentation WeWeb : Int√©gration Xano</a></li>
</ul>
