<h1>Construire une logique m√©tier robuste avec WeWeb et Xano</h1>

<p class="subtitle">Retour d'exp√©rience sur la gestion d'√©tat, les workflows et les pi√®ges du no-code dans le cadre du Projet 10 : d√©veloppement d'une application de gestion de devis.</p>

<!-- Metadata block -->
<div class="metadata">
    <p>üè∑Ô∏è <strong>Cat√©gorie:</strong> Bonnes pratiques</p>
    <p>üéØ <strong>Niveau:</strong> Interm√©diaire</p>
    <p>üîç <strong>Mots-cl√©s:</strong> Gestion d'√©tat, Workflows WeWeb, Collections, Types de donn√©es, find(), On click, On change, On blur, Truthy/Falsy, Affichage conditionnel</p>
    <p>üìÖ <strong>Mise √† jour:</strong> 18/01/2026</p>
    <p>‚è±Ô∏è <strong>Temps pass√©:</strong> 1h</p>
    <p>‚öôÔ∏è <strong>Stack:</strong> WeWeb + Xano</p>
</div>

<!-- TL;DR -->
<div class="tldr">
‚úÖ <strong>TL;DR :</strong>
Le no-code ne supprime pas la complexit√©, il la d√©place vers la compr√©hension des flux et des donn√©es. Dans le Projet 10, les vrais d√©fis n'√©taient pas techniques mais conceptuels : ma√Ætriser les types de donn√©es, g√©rer correctement les √©tats UI, et construire des workflows robustes. Cet article partage les apprentissages cl√©s d'un projet r√©el de gestion de devis avec WeWeb et Xano.
</div>

<h2>ü§î Probl√®me rencontr√©</h2>

<p><strong>üõë Contexte du projet :</strong> D√©veloppement d'une application de gestion de devis avec fonctionnalit√©s de panier (ajout/suppression de produits, calcul automatique des totaux).</p>

<p><strong>üí° Enjeu initial :</strong> Au-del√† de l'interface utilisateur, le v√©ritable d√©fi s'est rapidement r√©v√©l√© √™tre la gestion correcte des donn√©es, des √©tats et des workflows dans un environnement no-code qui impose ses propres contraintes.</p>

<p>Les probl√®mes r√©currents rencontr√©s incluaient :</p>
<ul>
    <li>Mauvaise ligne mise √† jour ou supprim√©e dans le panier</li>
    <li>Erreurs de type "requires a scalar value" ou "text/integer filter requires‚Ä¶"</li>
    <li>Composants affich√©s alors qu'aucune valeur n'est s√©lectionn√©e</li>
    <li>Appels API d√©clench√©s trop fr√©quemment</li>
    <li>√âtats incoh√©rents entre le front-end et le back-end</li>
</ul>

<h2>üîç Explication : Les 6 piliers d'une logique m√©tier robuste</h2>

<p>Ce projet a mis en lumi√®re 6 domaines de comp√©tence essentiels pour construire une application fiable en no-code :</p>

<h3>1Ô∏è‚É£ Gestion d'un panier : bien plus qu'un simple CRUD</h3>

<p>La gestion d'un panier de produits n√©cessite de ma√Ætriser plusieurs concepts :</p>

<ul>
    <li><strong>Ajout d'un produit au devis</strong></li>
    <li><strong>Incr√©mentation / d√©cr√©mentation de la quantit√©</strong></li>
    <li><strong>Suppression automatique</strong> de la ligne lorsque la quantit√© atteint z√©ro</li>
    <li><strong>Mise √† jour correcte du devis</strong> apr√®s chaque action</li>
</ul>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Pi√®ge fr√©quent</strong><br>
Confusion entre <code>produit_id</code> (identifiant du produit) et <code>p10_panierdevis_id</code> (identifiant de la relation produit ‚Üî devis). Cette confusion entra√Æne la mise √† jour ou suppression de la mauvaise ligne.
</div>

<p><strong>üîë Solution :</strong> Utilisation syst√©matique de <code>find()</code> avec un crit√®re strict au lieu de s'appuyer sur des index (<code>[0]</code>). S√©parer clairement l'ID du produit de l'ID de la ligne panier.</p>

<h3>2Ô∏è‚É£ Comprendre les donn√©es retourn√©es par WeWeb et Xano</h3>

<p>Un th√®me central du projet a √©t√© la compr√©hension des types de donn√©es r√©ellement manipul√©s.</p>

<div class="callout callout-tip">
‚ú® <strong>R√®gle d'or</strong><br>
Dans WeWeb et Xano :<br>
‚Ä¢ Une <strong>collection</strong> n'est jamais une valeur scalaire<br>
‚Ä¢ Une <strong>requ√™te SQL</strong> retourne souvent une liste, m√™me avec une seule ligne<br>
‚Ä¢ Un <strong>champ typ√©</strong> (integer, text) n'accepte jamais un objet
</div>

<p><strong>Distinctions fondamentales √† ma√Ætriser :</strong></p>
<ul>
    <li>Objet vs Liste vs Valeur scalaire</li>
    <li>ID m√©tier vs ID technique</li>
    <li>√âtat UI vs √âtat back-end</li>
    <li>Collection vs R√©sultat de requ√™te</li>
</ul>

<h3>3Ô∏è‚É£ Gestion fine des √©v√©nements c√¥t√© front (WeWeb)</h3>

<p>La gestion des interactions utilisateur n√©cessite une compr√©hension pr√©cise des √©v√©nements disponibles.</p>

<table>
    <thead>
        <tr>
            <th>√âv√©nement</th>
            <th>Quand l'utiliser</th>
            <th>Cas d'usage</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>On change</code></td>
            <td>√Ä chaque modification de valeur</td>
            <td>Validation en temps r√©el, mais attention au spam d'API</td>
        </tr>
        <tr>
            <td><code>On blur</code></td>
            <td>Lorsque l'utilisateur quitte le champ</td>
            <td>Mise √† jour API apr√®s saisie stabilis√©e (recommand√©)</td>
        </tr>
        <tr>
            <td><code>On click</code></td>
            <td>Action utilisateur explicite</td>
            <td>Boutons d'action, soumission de formulaire</td>
        </tr>
    </tbody>
</table>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Attention</strong><br>
Utiliser <code>On change</code> pour mettre √† jour une API √† chaque frappe peut g√©n√©rer des dizaines d'appels inutiles. Pr√©f√©rer <code>On blur</code> ou impl√©menter un debounce.
</div>

<h3>4Ô∏è‚É£ Affichage conditionnel et √©tats UI</h3>

<p>Les composants WeWeb (Selects, Inputs) ne renvoient pas toujours <code>null</code> lorsqu'ils sont vides. Ils peuvent renvoyer :</p>
<ul>
    <li><code>null</code></li>
    <li><code>undefined</code></li>
    <li><code>""</code> (cha√Æne vide)</li>
</ul>

<div class="callout callout-tip">
‚ú® <strong>Solution robuste</strong><br>
Utiliser des tests de v√©rit√© (<strong>truthy / falsy</strong>) au lieu de comparaisons strictes avec <code>null</code>.<br><br>
<strong>Exemple :</strong> <code>if (selectedValue)</code> au lieu de <code>if (selectedValue !== null)</code>
</div>

<h3>5Ô∏è‚É£ Construction de workflows complexes et lisibles</h3>

<p>Un workflow robuste n√©cessite :</p>
<ul>
    <li>‚úÖ Tests conditionnels imbriqu√©s clairs</li>
    <li>‚úÖ Branches true / false explicites</li>
    <li>‚úÖ S√©quences d√©pendantes bien ordonn√©es</li>
    <li>‚úÖ Rafra√Æchissement des collections au bon moment</li>
    <li>‚úÖ Refus des "raccourcis" qui masquent la logique</li>
</ul>

<div class="callout callout-advanced">
üî¨ <strong>Pour aller plus loin</strong><br>
Un workflow maintenable doit pouvoir √™tre lu et compris par un autre d√©veloppeur sans documentation suppl√©mentaire. Privil√©giez la clart√© √† la concision.
</div>

<h3>6Ô∏è‚É£ Ma√Ætrise des types : le vrai fil conducteur</h3>

<p>Avec le recul, le probl√®me principal du projet n'√©tait ni WeWeb ni Xano, mais la <strong>gestion des types et des structures de donn√©es</strong>.</p>

<p><strong>Distinctions fondamentales :</strong></p>
<ul>
    <li>Valeur vs Structure</li>
    <li>ID m√©tier vs ID technique</li>
    <li>Liste vs Objet</li>
    <li>√âtat UI vs √âtat back-end</li>
</ul>

<div class="callout callout-tip">
‚ú® <strong>Astuce de d√©bogage</strong><br>
Chaque bug rencontr√© √©tait un sympt√¥me d'une mauvaise hypoth√®se sur la forme r√©elle des donn√©es. Avant de corriger, toujours v√©rifier la structure exacte retourn√©e par la requ√™te ou la collection.
</div>

<h2>üß™ Solution : Proc√©dure pour √©viter les pi√®ges</h2>

<h3>√âtape 1Ô∏è‚É£ : Identifier la nature des donn√©es</h3>
<p>Avant toute manipulation, v√©rifier :</p>
<ul>
    <li>Est-ce une valeur scalaire (string, number) ou une structure (objet, liste) ?</li>
    <li>Est-ce un r√©sultat de requ√™te Xano ou une variable WeWeb ?</li>
    <li>Quels sont les identifiants disponibles (ID technique, ID m√©tier) ?</li>
</ul>

<h3>√âtape 2Ô∏è‚É£ : Choisir le bon √©v√©nement</h3>
<pre><code>// ‚ùå Mauvais : spam d'API
On change ‚Üí API call

// ‚úÖ Bon : mise √† jour stabilis√©e
On blur ‚Üí API call

// ‚úÖ Encore mieux : action explicite
On click (bouton "Enregistrer") ‚Üí API call
</code></pre>

<h3>√âtape 3Ô∏è‚É£ : Utiliser find() au lieu d'index</h3>
<pre><code>// ‚ùå Mauvais : fragile et impr√©cis
panierDevis[0]

// ‚úÖ Bon : cibl√© et robuste
panierDevis.find(item => item.p10_panierdevis_id === currentLineId)
</code></pre>

<h3>√âtape 4Ô∏è‚É£ : G√©rer les valeurs vides avec truthy/falsy</h3>
<pre><code>// ‚ùå Mauvais : ne couvre pas tous les cas
if (selectedValue !== null)

// ‚úÖ Bon : couvre null, undefined, ""
if (selectedValue)
</code></pre>

<h3>√âtape 5Ô∏è‚É£ : Documenter les workflows complexes</h3>
<p>Ajouter des commentaires explicites dans les workflows WeWeb pour expliquer la logique m√©tier, pas seulement les √©tapes techniques.</p>

<h2>üß∞ Exemple concret : Gestion du panier de devis</h2>

<h3>Cas d'usage : Incr√©menter la quantit√© d'un produit</h3>

<p><strong>Workflow WeWeb :</strong></p>

<div class="figure">
<pre><code>1. On click (bouton "+")
2. R√©cup√©rer l'ID de la ligne panier (p10_panierdevis_id)
3. Rechercher la ligne avec find() :
   currentLine = panierDevis.find(item => item.p10_panierdevis_id === lineId)
4. Incr√©menter la quantit√© :
   newQuantity = currentLine.quantite + 1
5. Appel API Xano : updatePanierDevisLine(lineId, newQuantity)
6. Rafra√Æchir la collection panierDevis
7. Recalculer le total du devis
</code></pre>
</div>

<div class="callout callout-warning">
‚ö†Ô∏è <strong>Point de vigilance</strong><br>
Ne jamais utiliser <code>produit_id</code> pour identifier la ligne √† modifier. Utiliser <code>p10_panierdevis_id</code> (ID de la relation).
</div>

<h3>Cas d'usage : Suppression automatique si quantit√© = 0</h3>

<p><strong>Workflow WeWeb :</strong></p>

<div class="figure">
<pre><code>1. On click (bouton "-")
2. R√©cup√©rer la quantit√© actuelle
3. Condition :
   IF quantite > 1
     ‚Üí D√©cr√©menter (quantite - 1)
     ‚Üí API : updatePanierDevisLine()
   ELSE
     ‚Üí API : deletePanierDevisLine()
4. Rafra√Æchir la collection panierDevis
5. Recalculer le total du devis
</code></pre>
</div>

<h2>üìå R√©sum√© final</h2>

<div class="summary">
üìå <strong>√Ä retenir :</strong>
<ul>
    <li><strong>Le no-code ne supprime pas la complexit√©</strong>, il la d√©place vers la compr√©hension des flux et des donn√©es</li>
    <li><strong>Ma√Ætriser les types de donn√©es</strong> est la comp√©tence fondamentale pour √©viter 80% des bugs</li>
    <li><strong>Utiliser find() au lieu d'index</strong> pour cibler pr√©cis√©ment les √©l√©ments de collection</li>
    <li><strong>Choisir le bon √©v√©nement</strong> (On change vs On blur vs On click) pour optimiser les appels API</li>
    <li><strong>G√©rer les valeurs vides avec truthy/falsy</strong> pour un code plus robuste</li>
    <li><strong>Construire des workflows lisibles</strong> en privil√©giant la clart√© √† la concision</li>
    <li><strong>S√©parer les identifiants m√©tier et techniques</strong> (produit_id vs p10_panierdevis_id)</li>
</ul>
</div>

<h2>üß† Quiz rapide</h2>

<p><strong>Question 1 :</strong> Quel √©v√©nement WeWeb devez-vous utiliser pour mettre √† jour une API apr√®s que l'utilisateur a fini de saisir un texte dans un input ?</p>
<p>‚úÖ <strong>R√©ponse :</strong> <code>On blur</code> (plut√¥t que <code>On change</code> qui d√©clencherait l'API √† chaque frappe)</p>

<p><strong>Question 2 :</strong> Comment cibler pr√©cis√©ment une ligne sp√©cifique dans une collection WeWeb ?</p>
<p>‚úÖ <strong>R√©ponse :</strong> Utiliser <code>find()</code> avec un crit√®re strict (ex: <code>item.id === currentId</code>) plut√¥t qu'un index comme <code>[0]</code></p>

<p><strong>Question 3 :</strong> Comment g√©rer proprement les valeurs vides (null, undefined, "") dans une condition d'affichage ?</p>
<p>‚úÖ <strong>R√©ponse :</strong> Utiliser un test truthy/falsy simple : <code>if (value)</code> plut√¥t que <code>if (value !== null)</code></p>

<h2>üîó Liens utiles</h2>

<ul>
    <li><a href="https://docs.weweb.io/" target="_blank">Documentation officielle WeWeb</a></li>
    <li><a href="https://docs.xano.com/" target="_blank">Documentation officielle Xano</a></li>
    <li>üìñ Article connexe : <em>Comprendre les Collections dans WeWeb</em> (√† venir)</li>
    <li>üìñ Article connexe : <em>G√©rer les √©v√©nements dans WeWeb : On change, On blur, On click</em> (√† venir)</li>
</ul>
